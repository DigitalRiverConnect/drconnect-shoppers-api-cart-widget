/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

/**
 * An API Library for making JSON P calls without jQuery.
 * @author Christopher Pryce<cpryce@digitalriver.com>
 *
 * Based on JSON and JSONP By Angus Croll
 * http://javascriptweblog.wordpress.com/2010/11/29/json-and-jsonp/
 *
 * Copyright 2013 Christopher Pryce
 * No use restrictions. Code is distributed AS IS with no implicit or explicit warranty
 *
 *
 * Module definition
 * @dependencies Q or an other library that supports CommonJS Promises/A API
 */

//     Underscore.js 1.6.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("node_modules/almond/almond",function(){}),define("util/Class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,n=function(){};return n.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o},n}),define("config",[],function(){var e={env:"prod",connection:{},emptyOfferPop:"SiteMerchandising_EmptyCart",defaultCurrency:"USD",defaultLocale:"en_US",vanityDomain:"store.digitalriver.com"};return e.connection.URI={BASE_URL:null,DEV_BASE_URL:"http://23.21.197.49",SYS_BASE_URL:"http://23.21.197.49:2080",PRD_BASE_URL:"https://api.digitalriver.com",CTE_BASE_URL:"https://api-cte.digitalriver.com",VERSION:"v1",ANONYMOUS_LOGIN:"shoppers/token",CATEGORY_RESOURCE:"shoppers/me/categories",CART_RESOURCE:"shoppers/me/carts/active",OFFER_RESOURCE:"shoppers/me/point-of-promotions",WEB_CHECKOUT:"shoppers/me/carts/active/web-checkout",SHOPPER:"shoppers/me",HOME_PAGE_OFFER:"shoppers/me/point-of-promotions",LINE_ITEM_RESOURCE:"shoppers/me/carts/active/line-items",PRODUCT_RESOURCE:"shoppers/me/products"},{getBaseUrl:function(){var t=this,n=e.connection.URI,r;switch(t.getEnv()){case"dev":r=n.DEV_BASE_URL;break;case"sys":r=n.SYS_BASE_URL;break;case"cte":r=n.CTE_BASE_URL;break;case"prod":default:r=n.PRD_BASE_URL}return r},getHomePageOfferUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.OFFER_RESOURCE,e.homePagePop,"offers",e.homePageOfferId,"product-offers"].join("/")},getAnonymousLoginUri:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.ANONYMOUS_LOGIN].join("/")},getTokenServiceUri:function(e,t){var n=this,r=e||n.getDefaultLocale(),i=["Action=ShopDomain","Locale="+r,"SiteId="+t].join("&");return"https://"+n.getVanityDomain()+"/store?"+i},getCategoryResourceUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.CATEGORY_RESOURCE].join("/")},getCartResourceUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.CART_RESOURCE].join("/")},getWebCheckoutUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.WEB_CHECKOUT].join("/")},getEmptyOfferUrl:function(){var t=this,n=e.connection.URI;if(e.emptyOfferPop!=null&&e.emptyOfferId!=null)return[t.getBaseUrl(),n.VERSION,n.OFFER_RESOURCE,e.emptyOfferPop,"offers",e.emptyOfferId].join("/")},getLineItemUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.LINE_ITEM_RESOURCE].join("/")},getProductResourceURL:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.PRODUCT_RESOURCE].join("/")},getShopperUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.SHOPPER].join("/")},getEnv:function(){return e.env},setEnv:function(t){e.env=t},getApiKey:function(){return e.apiKey},setApiKey:function(t){e.apiKey=t},getDefaultCurrency:function(){return e.defaultCurrency},setDefaultCurrency:function(t){e.defaultCurrency=t},getDefaultLocale:function(){return e.defaultLocale},setDefaultLocale:function(t){e.defaultLocale=t},getEmptyOfferId:function(){return e.emptyOfferId},setEmptyOfferId:function(t){e.emptyOfferId=t},getEmptyOfferPop:function(){return e.emptyOfferPop},setEmptyOfferPop:function(t){e.emptyOfferPop=t},getSiteId:function(){return e.siteId},setSiteId:function(t){e.siteId=t},getVanityDomain:function(){return e.vanityDomain},setVanityDomain:function(t){e.vanityDomain=t}}}),function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof exports=="object")module.exports=e();else if(typeof define=="function"&&define.amd)define("node_modules/q/q",e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){function u(e){return function(){return o.apply(e,arguments)}}function m(e){return e===Object(e)}function g(e){return v(e)==="[object StopIteration]"||e instanceof y}function E(t,n){if(e&&n.stack&&typeof t=="object"&&t!==null&&t.stack&&t.stack.indexOf(w)===-1){var r=[];for(var i=n;!!i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(t.stack);var s=r.join("\n"+w+"\n");t.stack=S(s)}}function S(e){var t=e.split("\n"),n=[];for(var r=0;r<t.length;++r){var i=t[r];!N(i)&&!x(i)&&i&&n.push(i)}return n.join("\n")}function x(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function T(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);if(r)return[r[1],Number(r[2])]}function N(e){var t=T(e);if(!t)return!1;var i=t[0],s=t[1];return i===r&&s>=n&&s<=lt}function C(){if(!e)return;try{throw new Error}catch(t){var n=t.stack.split("\n"),i=n[0].indexOf("@")>0?n[1]:n[2],s=T(i);if(!s)return;return r=s[0],s[1]}}function k(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function L(e){return H(e)?e:B(e)?G(e):Q(e)}function A(){function l(e){r=e,o.source=e,f(t,function(t,n){s(function(){e.promiseDispatch.apply(e,n)})},void 0),t=void 0,n=void 0}var t=[],n=[],r,i=h(A.prototype),o=h(_.prototype);o.promiseDispatch=function(e,i,o){var u=a(arguments);t?(t.push(u),i==="when"&&o[1]&&n.push(o[1])):s(function(){r.promiseDispatch.apply(r,u)})},o.valueOf=function(){if(t)return o;var e=P(r);return H(e)&&(r=e),e},o.inspect=function(){return r?r.inspect():{state:"pending"}};if(L.longStackSupport&&e)try{throw new Error}catch(u){o.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(e){if(r)return;l(L(e))},i.fulfill=function(e){if(r)return;l(Q(e))},i.reject=function(e){if(r)return;l(K(e))},i.notify=function(e){if(r)return;f(n,function(t,n){s(function(){n(e)})},void 0)},i}function O(e){if(typeof e!="function")throw new TypeError("resolver must be a function.");var t=A();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function M(e){return O(function(t,n){for(var r=0,i=e.length;r<i;r++)L(e[r]).then(t,n)})}function _(e,t,n){t===void 0&&(t=function(e){return K(new Error("Promise does not support operation: "+e))}),n===void 0&&(n=function(){return{state:"unknown"}});var r=h(_.prototype);r.promiseDispatch=function(n,i,s){var o;try{e[i]?o=e[i].apply(r,s):o=t.call(r,i,s)}catch(u){o=K(u)}n&&n(o)},r.inspect=n;if(n){var i=n();i.state==="rejected"&&(r.exception=i.reason),r.valueOf=function(){var e=n();return e.state==="pending"||e.state==="rejected"?r:e.value}}return r}function D(e,t,n,r){return L(e).then(t,n,r)}function P(e){if(H(e)){var t=e.inspect();if(t.state==="fulfilled")return t.value}return e}function H(e){return m(e)&&typeof e.promiseDispatch=="function"&&typeof e.inspect=="function"}function B(e){return m(e)&&typeof e.then=="function"}function j(e){return H(e)&&e.inspect().state==="pending"}function F(e){return!H(e)||e.inspect().state==="fulfilled"}function I(e){return H(e)&&e.inspect().state==="rejected"}function W(){!U&&typeof window!="undefined"&&window.console&&console.warn("[Q] Unhandled rejection reasons (should be empty):",q),U=!0}function X(){for(var e=0;e<q.length;e++){var t=q[e];console.warn("Unhandled rejection reason:",t)}}function V(){q.length=0,R.length=0,U=!1,z||(z=!0,typeof process!="undefined"&&process.on&&process.on("exit",X))}function $(e,t){if(!z)return;R.push(e),t&&typeof t.stack!="undefined"?q.push(t.stack):q.push("(no stack) "+t),W()}function J(e){if(!z)return;var t=l(R,e);t!==-1&&(R.splice(t,1),q.splice(t,1))}function K(e){var t=_({when:function(t){return t&&J(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return $(t,e),t}function Q(e){return _({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return t===null||t===void 0?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return d(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function G(e){var t=A();return s(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function Y(e){return _({isDef:function(){}},function(n,r){return it(e,n,r)},function(){return L(e).inspect()})}function Z(e,t,n){return L(e).spread(t,n)}function et(e){return function(){function t(e,t){var s;if(b){try{s=n[e](t)}catch(o){return K(o)}return s.done?s.value:D(s.value,r,i)}try{s=n[e](t)}catch(o){return g(o)?o.value:K(o)}return D(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"next"),i=t.bind(t,"throw");return r()}}function tt(e){L.done(L.async(e)())}function nt(e){throw new y(e)}function rt(e){return function(){return Z([this,st(arguments)],function(t,n){return e.apply(t,n)})}}function it(e,t,n){return L(e).dispatch(t,n)}function st(e){return D(e,function(e){var t=0,n=A();return f(e,function(r,i,s){var o;H(i)&&(o=i.inspect()).state==="fulfilled"?e[s]=o.value:(++t,D(i,function(r){e[s]=r,--t===0&&n.resolve(e)},n.reject,function(e){n.notify({index:s,value:e})}))},void 0),t===0&&n.resolve(e),n.promise})}function ot(e){return D(e,function(e){return e=c(e,L),D(st(c(e,function(e){return D(e,i,i)})),function(){return e})})}function ut(e){return L(e).allSettled()}function at(e,t){return L(e).then(void 0,void 0,t)}function ft(e,t){return L(e).nodeify(t)}var e=!1;try{throw new Error}catch(t){e=!!t.stack}var n=C(),r,i=function(){},s=function(){function o(){while(e.next){e=e.next;var t=e.task;e.task=void 0;var r=e.domain;r&&(e.domain=void 0,r.enter());try{t()}catch(s){if(i)throw r&&r.exit(),setTimeout(o,0),r&&r.enter(),s;setTimeout(function(){throw s},0)}r&&r.exit()}n=!1}var e={task:void 0,next:null},t=e,n=!1,r=void 0,i=!1;s=function(e){t=t.next={task:e,domain:i&&process.domain,next:null},n||(n=!0,r())};if(typeof process!="undefined"&&process.nextTick)i=!0,r=function(){process.nextTick(o)};else if(typeof setImmediate=="function")typeof window!="undefined"?r=setImmediate.bind(window,o):r=function(){setImmediate(o)};else if(typeof MessageChannel!="undefined"){var u=new MessageChannel;u.port1.onmessage=function(){r=a,u.port1.onmessage=o,o()};var a=function(){u.port2.postMessage(0)};r=function(){setTimeout(o,0),a()}}else r=function(){setTimeout(o,0)};return s}(),o=Function.call,a=u(Array.prototype.slice),f=u(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),l=u(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),c=u(Array.prototype.map||function(e,t){var n=this,r=[];return f(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),h=Object.create||function(e){function t(){}return t.prototype=e,new t},p=u(Object.prototype.hasOwnProperty),d=Object.keys||function(e){var t=[];for(var n in e)p(e,n)&&t.push(n);return t},v=u(Object.prototype.toString),y;typeof ReturnValue!="undefined"?y=ReturnValue:y=function(e){this.value=e};var b;try{new Function("(function* (){ yield 1; })"),b=!0}catch(t){b=!1}var w="From previous event:";L.resolve=L,L.nextTick=s,L.longStackSupport=!1,L.defer=A,A.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(a(arguments,1)):e.resolve(n)}},L.promise=O,L.passByCopy=function(e){return e},_.prototype.passByCopy=function(){return this},L.join=function(e,t){return L(e).join(t)},_.prototype.join=function(e){return L([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},L.race=M,_.prototype.race=function(){return this.then(L.race)},L.makePromise=_,_.prototype.toString=function(){return"[object Promise]"},_.prototype.then=function(e,t,n){function u(t){try{return typeof e=="function"?e(t):t}catch(n){return K(n)}}function a(e){if(typeof t=="function"){E(e,r);try{return t(e)}catch(n){return K(n)}}return K(e)}function f(e){return typeof n=="function"?n(e):e}var r=this,i=A(),o=!1;return s(function(){r.promiseDispatch(function(e){if(o)return;o=!0,i.resolve(u(e))},"when",[function(e){if(o)return;o=!0,i.resolve(a(e))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=f(e)}catch(r){n=!0;if(!L.onerror)throw r;L.onerror(r)}n||i.notify(t)}]),i.promise},L.when=D,_.prototype.thenResolve=function(e){return this.then(function(){return e})},L.thenResolve=function(e,t){return L(e).thenResolve(t)},_.prototype.thenReject=function(e){return this.then(function(){throw e})},L.thenReject=function(e,t){return L(e).thenReject(t)},L.nearer=P,L.isPromise=H,L.isPromiseAlike=B,L.isPending=j,_.prototype.isPending=function(){return this.inspect().state==="pending"},L.isFulfilled=F,_.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"},L.isRejected=I,_.prototype.isRejected=function(){return this.inspect().state==="rejected"};var q=[],R=[],U=!1,z=!0;L.resetUnhandledRejections=V,L.getUnhandledReasons=function(){return q.slice()},L.stopUnhandledRejectionTracking=function(){V(),typeof process!="undefined"&&process.on&&process.removeListener("exit",X),z=!1},V(),L.reject=K,L.fulfill=Q,L.master=Y,L.spread=Z,_.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},L.async=et,L.spawn=tt,L["return"]=nt,L.promised=rt,L.dispatch=it,_.prototype.dispatch=function(e,t){var n=this,r=A();return s(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},L.get=function(e,t){return L(e).dispatch("get",[t])},_.prototype.get=function(e){return this.dispatch("get",[e])},L.set=function(e,t,n){return L(e).dispatch("set",[t,n])},_.prototype.set=function(e,t){return this.dispatch("set",[e,t])},L.del=L["delete"]=function(e,t){return L(e).dispatch("delete",[t])},_.prototype.del=_.prototype["delete"]=function(e){return this.dispatch("delete",[e])},L.mapply=L.post=function(e,t,n){return L(e).dispatch("post",[t,n])},_.prototype.mapply=_.prototype.post=function(e,t){return this.dispatch("post",[e,t])},L.send=L.mcall=L.invoke=function(e,t){return L(e).dispatch("post",[t,a(arguments,2)])},_.prototype.send=_.prototype.mcall=_.prototype.invoke=function(e){return this.dispatch("post",[e,a(arguments,1)])},L.fapply=function(e,t){return L(e).dispatch("apply",[void 0,t])},_.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},L["try"]=L.fcall=function(e){return L(e).dispatch("apply",[void 0,a(arguments,1)])},_.prototype.fcall=function(){return this.dispatch("apply",[void 0,a(arguments)])},L.fbind=function(e){var t=L(e),n=a(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(a(arguments))])}},_.prototype.fbind=function(){var e=this,t=a(arguments);return function(){return e.dispatch("apply",[this,t.concat(a(arguments))])}},L.keys=function(e){return L(e).dispatch("keys",[])},_.prototype.keys=function(){return this.dispatch("keys",[])},L.all=st,_.prototype.all=function(){return st(this)},L.allResolved=k(ot,"allResolved","allSettled"),_.prototype.allResolved=function(){return ot(this)},L.allSettled=ut,_.prototype.allSettled=function(){return this.then(function(e){return st(c(e,function(e){function t(){return e.inspect()}return e=L(e),e.then(t,t)}))})},L.fail=L["catch"]=function(e,t){return L(e).then(void 0,t)},_.prototype.fail=_.prototype["catch"]=function(e){return this.then(void 0,e)},L.progress=at,_.prototype.progress=function(e){return this.then(void 0,void 0,e)},L.fin=L["finally"]=function(e,t){return L(e)["finally"](t)},_.prototype.fin=_.prototype["finally"]=function(e){return e=L(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},L.done=function(e,t,n,r){return L(e).done(t,n,r)},_.prototype.done=function(e,t,n){var r=function(e){s(function(){E(e,i);if(!L.onerror)throw e;L.onerror(e)})},i=e||t||n?this.then(e,t,n):this;typeof process=="object"&&process&&process.domain&&(r=process.domain.bind(r)),i.then(void 0,r)},L.timeout=function(e,t,n){return L(e).timeout(t,n)},_.prototype.timeout=function(e,t){var n=A(),r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},L.delay=function(e,t){return t===void 0&&(t=e,e=void 0),L(e).delay(t)},_.prototype.delay=function(e){return this.then(function(t){var n=A();return setTimeout(function(){n.resolve(t)},e),n.promise})},L.nfapply=function(e,t){return L(e).nfapply(t)},_.prototype.nfapply=function(e){var t=A(),n=a(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},L.nfcall=function(e){var t=a(arguments,1);return L(e).nfapply(t)},_.prototype.nfcall=function(){var e=a(arguments),t=A();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},L.nfbind=L.denodeify=function(e){var t=a(arguments,1);return function(){var n=t.concat(a(arguments)),r=A();return n.push(r.makeNodeResolver()),L(e).fapply(n).fail(r.reject),r.promise}},_.prototype.nfbind=_.prototype.denodeify=function(){var e=a(arguments);return e.unshift(this),L.denodeify.apply(void 0,e)},L.nbind=function(e,t){var n=a(arguments,2);return function(){function s(){return e.apply(t,arguments)}var r=n.concat(a(arguments)),i=A();return r.push(i.makeNodeResolver()),L(s).fapply(r).fail(i.reject),i.promise}},_.prototype.nbind=function(){var e=a(arguments,0);return e.unshift(this),L.nbind.apply(void 0,e)},L.nmapply=L.npost=function(e,t,n){return L(e).npost(t,n)},_.prototype.nmapply=_.prototype.npost=function(e,t){var n=a(t||[]),r=A();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},L.nsend=L.nmcall=L.ninvoke=function(e,t){var n=a(arguments,2),r=A();return n.push(r.makeNodeResolver()),L(e).dispatch("post",[t,n]).fail(r.reject),r.promise},_.prototype.nsend=_.prototype.nmcall=_.prototype.ninvoke=function(e){var t=a(arguments,1),n=A();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},L.nodeify=ft,_.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){s(function(){e(null,t)})},function(t){s(function(){e(t)})})};var lt=C();return L}),define("node_modules/jsonp/jsonp",["node_modules/q/q"],function(e){var t={callbackCounter:0,getJSON:function(t,n,r){var i=e.defer(),s=this,o,u,a;return r=r||s,o="JSONPCallback_"+s.callbackCounter,s.callbackCounter+=1,window[o]=s.evalJSONP(i),t=t.replace("=callback","="+o),u=document.createElement("SCRIPT"),u.src=t,a=document.getElementsByTagName("HEAD")[0].appendChild(u),i.promise.then(function(e){window[o]=undefined;try{delete window[o]}catch(t){}try{a.parentNode.removeChild(a)}catch(t){}return e}).then(function(e){return typeof n=="function"&&n.call(r,e),e})},evalJSONP:function(e){return function(t){var n=!1;if(typeof t=="string")try{n=JSON.parse(t)}catch(r){}else n=JSON.parse(JSON.stringify(t));n?e.resolve(n):e.reject("JSONP call returned invalid or empty JSON")}}};return t}),define("connection/Connection",["node_modules/jsonp/jsonp"],function(e){var t=function(){};return t.prototype={create:function(e,t,n,r){return this.request(e,"POST",t,n,r)},retrieve:function(e,t,n,r){return this.request(e,"GET",t,n,r)},update:function(e,t,n){return this.request(e,"PUT",t,n)},remove:function(e,t,n){return this.request(e,"DELETE",t,n)},submitForm:function(e,t,n){return n=n||{},n["Content-Type"]="application/x-www-form-urlencoded",this.request(e,"POST",{},n,t)},request:function(t,n,r){return e.getJSON(t,n,r)}},t}),define("connection/Session",["config","connection/Connection","node_modules/q/q"],function(e,t,n){var r=function(e){var n=this;n.apiKey=e,n._connection=new t,n.reset()};return r.prototype={getAccess:function(e){if(!e||e!=="authenticated")return this.getLimitedAccess()},getLimitedAccess:function(){var e=this,t=e.getAccessToken(),r;return t?e.isTokenTimeStampValid()?r=n(t):r=e.anonymousLogin():r=e.anonymousLogin(),r},isTokenTimeStampValid:function(){var e=this,t=(new Date).getTime();return e.tokenExpirationTime&&e.tokenExpirationTime>t},doRefreshToken:function(e){return this.anonymousLogin(e)},anonymousLogin:function(t){var n=this,r=new Date,i=n.getLocale(),s=e.getSiteId(),o;return o=e.getTokenServiceUri(i,s),n.pendingRequest==null&&(n.pendingRequest=n._connection.request(o,"GET").then(function(e){var t={ts:r.getTime(),apiKey:n.apiKey};return e.stickyParameters===null||e.stickyParameters===""?t.domain=e.shopDomain:(t.domain=e.shopDomain,t.cookie=e.stickyParameters),n.getAnnonymousAccessToken(t)})),n.pendingRequest},getAnnonymousAccessToken:function(t,n){var r=this,i=e.getAnonymousLoginUri();return r._connection.request(i,"GET",t).then(function(e){return r.connected=!0,r.setAccessToken(e.access_token),r.setRefreshToken(e.refresh_token),r.tokenStartTime=(new Date).getTime(),r.tokenExpirationTime=(new Date).getTime()+parseInt(e.expires_in*1e3,10),n&&typeof n.resolve=="function"&&n.resolve(e.access_token),r.pendingRequest=null,e.access_token}).fail(function(e){n&&typeof n.reject=="function"&&n.reject(e),r.reset(),r.pendingRequest=null})},updateShopperSession:function(t){var n=this;t&&(n._locale=t.Locale||e.getDefaultLocale())},reset:function(){var e=this;e.setAccessToken(null),e.setRefreshToken(null),e.connected=!1,e.tokenStartTime=null,e.tokenExpirationTime=null},getAccessToken:function(){return this._token},setAccessToken:function(e){this._token=e},getRefreshToken:function(){return this._refreshToken},setRefreshToken:function(e){this._refreshToken=e},getClient:function(){return this._client},getLocale:function(){return this._locale||e.getDefaultLocale()}},r}),define("service/BaseService",["util/Class","connection/Connection"],function(e,t){var n=e.extend({init:function(e){var n=this;n._client=e,n._connection=new t},list:function(e,t,n){var r=this;return e=e||r.uri,r._client.connect().then(function(i){var s=r._makeQueryParams({token:i},t);return r._connection.request(e,"GET",s,n)})},get:function(e,t,n){var r=this,i=[r.uri,e].join("/");return r._client.connect().then(function(e){var s=r._makeQueryParams({token:e},t);return r._connection.request(i,"GET",s,n)})},post:function(e,t){var n=this;return e=e||n.uri,n._client.connect().then(function(r){var i=n._makeQueryParams({token:r},t);return n._connection.request(e,"POST",i)})},remove:function(e,t){var n=this;return e=e||n.uri,n._client.connect().then(function(r){var i=n._makeQueryParams({token:r},t);return n._connection.request(e,"DELETE",i)})},_makeQueryParams:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}});return n}),define("service/Shopper",["util/Class","service/BaseService","config"],function(e,t,n){var r={currency:null,locale:null};return t.extend({init:function(){var e=this;e._super.apply(this,arguments),e.uri=n.getShopperUrl()},list:function(){var e=this;return e._super.apply(e,[e.uri,{expand:"currency,locale"}])},updateShopper:function(e){var t=this,i=n.getShopperUrl();return e==null&&(e={}),e.currency=e.currency||n.getDefaultCurrency(),e.locale=e.locale||n.getDefaultLocale(),t.post(i,e).then(function(t){return t.success&&(r.currency=e.currency,r.locale=e.locale),r})}})}),define("api/Client",["util/Class","connection/Session","service/Shopper"],function(e,t,n){return e.extend({init:function(e){var r=this;r._session=new t(e),r.shopperService=new n(r)},connect:function(){var e=this,t=e._session;return $(e).trigger("drconnect-beforeconnect",[e]),t.getAccess()},disconnect:function(){this._session.reset()},getSession:function(){return this._session},updateShopper:function(e){var t=this;return this.shopperService.updateShopper(e).then(function(e){return t._session.updateShopperSession(e),e},function(e){throw e})}})}),define("util/util",[],function(){var e={};return e.getAttribute=function(e,t){var n=t.split("."),r=e,i="";for(var s=0,o=n.length;s<o;s++)i=n[s],r[i]=r[i]||{},r=r[i];return r},e.setAttribute=function(e,t,n){var r=t.split("."),i=e,s="";for(var o=0,u=r.length;o<u-1;o++)s=r[o],i[s]=i[s]||{},i=i[s];i[r[u-1]]=n},e.getQueryStringParam=function(e,t){var n=(new RegExp("[\\?&]"+t+"=([^&#]*)")).exec(e);return n?n[1]||0:""},e.getCurrentPath=function(){var e=window.location.href.replace(window.location.hash,"");return e.substring(0,e.lastIndexOf("/"))},e}),define("service/CartService",["util/Class","service/BaseService","config","node_modules/q/q","util/util"],function(e,t,n,r,i){var s=null,o=t.extend({init:function(e){var t=this;t._super.apply(t,arguments),t.uri=n.getCartResourceUrl()},getActiveCart:function(){var e=this;return this.list(n.getCartResourceUrl(),{expand:"pricing.all,lineitems.lineitem.product,lineitems.lineitem.pricing.all,shippingOptions,shippingMethods"}).then(function(e){return e.cart})},getEmptyCartOffer:function(){var e=this;return s===null&&n.getEmptyOfferUrl()!=null?defer=this.list(n.getEmptyOfferUrl(),{expand:"productOffers.productOffer.addProductToCart"}).then(function(e){return s=e.offer,s},function(){defer=null}):defer=r(s),defer},applyCouponCode:function(e){var t=this;if($(t).triggerHandler("drconnect-beforeapplycode",[e])!==!1)return t.post(null,{promoCode:e}).then(function(e){return t.getActiveCart()},function(){return t.getActiveCart()})},addLineItemToCart:function(e){var t=this,r=i.getQueryStringParam(e,"productId"),s=[n.getProductResourceURL(),r].join("/");if($(t).triggerHandler("drconnect-beforeaddproduct",[e])!==!1)return t.list(s).then(function(n){if(n.product&&n.product.variations&&n.product.variations.product)throw $(t).trigger("drconnect-carterror",["Base  products can't be purchased."]),"Cannot add product to cart.";return t.post(e).then(function(e){return t.getActiveCart()},function(e){throw $(t).trigger("drconnect-carterror",[e]),e})},function(e){throw $(t).trigger("drconnect-carterror",[e]),e})},addLineItemToCartById:function(e,t,i){var s=this,o=[n.getProductResourceURL(),e].join("/");t=t||1;if($(s).triggerHandler("drconnect-beforeaddproduct",[o])!==!1)return s.list(o).then(function(o){return o.product&&o.product.variations&&o.product.variations.product?r(i):s.post(n.getLineItemUrl(),{productId:e,quantity:t}).then(function(e){return s.getActiveCart()},function(e){throw e.message="Unable to Add Item to cart",$(s).trigger("drconnect-carterror",[e]),e})},function(e){throw e.message="Unable to Add Item to cart",$(s).trigger("drconnect-carterror",[e]),e})},updateQuantity:function(e,t){var r=this,i=[n.getCartResourceUrl(),"line-items",e].join("/");if($(r).triggerHandler("drconnect-beforequantityupdate",[t,e])!==!1)return r.post(i,{quantity:t,expand:"all"}).then(function(n){return $(r).trigger("drconnect-quantityupdate",[t,e]),r.getActiveCart()},function(e){throw $(r).trigger("drconnect-carterror",[e]),e})},removeLineItem:function(e){var t=this,r=[n.getCartResourceUrl(),"line-items",e].join("/");if($(t).triggerHandler("drconnect-beforeremoveitem",[e])!==!1)return t.remove(r).then(function(){return t.getActiveCart()},function(e){return t.getActiveCart()})},getWebCheckoutUrl:function(){return this._client.connect().then(function(e){return n.getWebCheckoutUrl()+"?token="+e},function(){return"Unable to checkout"})},clearCache:function(){s=null}});return o}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?void (this._wrapped=e):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.6.0";var T=x.each=x.forEach=function(e,t,r){if(null==e)return e;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o=x.keys(e),i=0,s=o.length;s>i;i++)if(t.call(r,e[o[i]],o[i],e)===n)return;return e};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,x.property(t))},x.where=function(e,t){return x.filter(e,x.matches(t))},x.findWhere=function(e,t){return x.find(e,x.matches(t))},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,i=-1/0;return T(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;u>i&&(r=e,i=u)}),r},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,i=1/0;return T(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;i>u&&(r=e,i=u)}),r},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return null==e?x.identity:x.isFunction(e)?e:x.property(e)};x.sortBy=function(e,t,n){return t=k(t),x.pluck(x.map(e,function(e,r,i){return{value:e,index:r,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={};return n=k(n),T(t,function(s,o){var u=n.call(r,s,o,t);e(i,u,s)}),i}};x.groupBy=L(function(e,t,n){x.has(e,t)?e[t].push(n):e[t]=[n]}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.partition=function(e,t){var n=[],r=[];return T(e,function(e){(t(e)?n:r).push(e)}),[n,r]},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.contains(t,e)})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);r>i;)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===x&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},x.bindAll=function(e){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:x.now(),o=null,s=e.apply(r,i),r=i=null};return function(){var f=x.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),r=i=null):o||n.trailing===!1||(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=x.now()-o;t>f?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),s=i=null))};return function(){s=this,i=arguments,o=x.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return x.partial(t,e)},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=function(e){if(!x.isObject(e))return[];if(E)return E(e);var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){for(var t=x.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},x.pairs=function(e){for(var t=x.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){for(var t={},n=x.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var a=0,l=!0;if("[object Array]"==i){if(a=e.length,l=a==t.length)for(;a--&&(l=M(e[a],t[a],n,r)););}else{for(var c in e)if(x.has(e,c)&&(a++,!(l=x.has(t,c)&&M(e[c],t[c],n,r))))break;if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.property=function(e){return function(t){return t[e]}},x.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},x.times=function(e,t,n){for(var r=Array(Math.max(0,e)),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(null==e)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),define("node_modules/underscore/underscore-min",function(e){return function(){var t,n;return t||e._}}(this)),define("view/BaseView",["util/Class"],function(e){return e.extend({init:function(e){var t=this;t.setOptions(e),t.compileTemplates()},compileTemplates:function(){},setOptions:function(e){var t=this;t.options=$.extend({},t.getDefaults(),e)},getOptions:function(){var e=this;return e.options?e.options:{}},getOption:function(e){var t=this;return t.options[e]},setOption:function(e,t){var n=this;n.options[e]=t},getDefaults:function(){return{}}})}),define("view/CartView",["node_modules/underscore/underscore-min","view/BaseView"],function(e,t){function r(e){var t=this,n=t.getOptions();$(n.summaryElementSelector).append(t.summaryTemplate(e))}function i(){var t=this,n=t.getOptions(),r=$('<div class="connect-cart-wrapper"></div>').appendTo(n.cartElementSelector),i,s,o,u,a,f;i=$("#drMiniCartHeaderTemplate"),i.length?i=i.get(0).html():i=e.template(n.cartHeaderTemplate),r.prepend(i),e.each(n.currency,function(e){var t=$('<option value="'+e+'">'+e+"</option>");e===n.defaultCurrency&&t.attr("selected","selected"),r.find(".connect-cart-currencyselector").append(t)}),s=$("#drMiniCartBodyTemplate"),s.length?(f=n.emptyCartTemplate,s=s.get(0).html()):(f=n.emptyCartTemplate,s=e.template(n.bodyTemplate,{emptyCartMessage:f})),r.append(s),o=$("#drMiniCartTotalTemplate"),o.length?o=o.get(0).html():o=e.template(n.totalsTemplate),r.append(o),u=$("#drMiniCartCouponTemplate"),u.length?u=u.get(0).html():u=e.template(n.couponTemplate),r.append(u),a=$("#drMiniCartFooterTemplate"),a.length?a=e.template(a.html()):a=e.template(n.footerTemplate),r.append(a)}console.log(e);var n={summaryTemplate:'<div class="connect-cart-summary"><h3><span>Shopping Cart</span> (<span class="connect-cart-quantity"><%= qty %></span>)</h3></div>',cartTemplate:'<div id="drMiniCart" class="connect-mini-cart"></div>',cartHeaderTemplate:'<div class="connect-cart-header">   <div class="connect-cart-feedback"></div>   <div class="connect-cart-currency">       <label for="drCartCurrencySelector">Currency:</label>       <select id="drCartCurrencySelector" class="connect-cart-currencyselector">       </select>   </div></div><div class="connect-cart-offerheader"></div>',bodyTemplate:'<div class="connect-cart-body connect-loading">   <div class="connect-cart-loadingmask">      <span class="connect-spinner"></span>   </div>   <div class="connect-content">       <%= emptyCartMessage %>   </div></div>',emptyCartTemplate:"<p>Your Shopping Cart is empty.</p>",totalsTemplate:'<div class="connect-cart-totals">   <div class="connect-cart-subtotal">       <span>Subtotal:</span><span class="amount">0.00</span></div>   <div class="connect-fine-print">       <span>Excludes tax and shipping</span>   </div></div>',couponTemplate:'<div class="connect-cart-couponwrapper connect-widget-button">    <input id="couponCode" class="connect-widget-couponcode" type="text" value="" placeholder="Enter Coupon Code"/>    <a class="connect-cart-applycoupon" disabled="disabled" href="#">        <i class="icon-ok-sign"></i> Apply Code    </a></div>',footerTemplate:'<div class="connect-cart-footer">    <div class="connect-widget-link">        <a href="#" class="connect-cart-showcode">Have a Promo Code?</a>    </div>    <div class="connect-widget-button right">        <a href="#" class="connect-cart-checkout"><i class="icon-shopping-cart icon"></i> Checkout</a>    </div>    <div class="connect-widget-clearfix"></div></div>',offerHeaderTemplate:"<span><%= offerHeader %></span>",offerTemplate:'<div class="connect-cart-offer"><p class="connect-cart-title"><%= product.displayName %></p><% if (pricing && (pricing.listPrice.value > pricing.salePriceWithQuantity.value)) { %><p><img class="connect-cart-image" src="<%= product.thumbnailImage %>" alt=""/><span class="connect-cart-pricing"><span>Regular Price: </span><span class="connect-widget-strikethrough"><del><%= pricing.formattedListPrice %></del></span></span><span class="connect-cart-pricing"><span>Promo Price: </span><span><%= pricing.formattedSalePriceWithQuantity %></span></span><%} else { %><p><img class="connect-cart-image" src="<%= product.thumbnailImage %>" alt=""/><span class="connect-cart-pricing"><%= pricing.formattedSalePriceWithQuantity %></span><% } %><div class="connect-widget-button"><a class="connect-cart-buy" data-value="<%= addProductToCart.uri %>" href="<%= addProductToCart.uri %>"><i class="icon-plus-sign"></i> Add</a></div></p><div style="line-height: 1; clear: both;"></div></div>',productTemplate:'<div class="connect-cart-lineitem"><p class="connect-cart-title" title="<%= product.shortDescription %>"><%= product.displayName %></p><img src="<%= product.thumbnailImage %>"/><div><span>Quantity: </span>   <input autocomplete="off" type="text" class="connect-cart-quantity" data-lineitem-id="<%= id %>" value="<%= quantity %>"<% if (product.inventoryStatus && product.inventoryStatus.maxOrderQuantity !== undefined){ %> data-maxorderquantity=<%=product.inventoryStatus.maxOrderQuantity%><%} %>/>   <span class="connect-widget-button"><a class="connect-cart-updatebtn" href="#"><i class="icon-refresh"></i></a></span></div><ul><li class="connect-cart-remove"><span><a href="#" data-lineitem-id="<%= id %>"><i class="icon-remove"></i> Remove</a></span></li><li class="connect-cart-sku"><span class="connect-cart-label">SKU: <%= product.sku %></span></li><li class="connect-lineitem-pricing"><span class="connect-cart-label">Price: </span><% if (pricing.listPriceWithQuantity.value > pricing.salePriceWithQuantity.value) { %> <span class="connect-widget-strikethrough"><%= pricing.formattedListPriceWithQuantity %>&nbsp;</span><%}%><span class="connect-lineitem-saleprice"><%= pricing.formattedSalePriceWithQuantity %></span></li></ul><div style="line-height: 1; clear: both;">&nbsp;</div></div>',subtotalTemplate:'<% if (discount.value && discount.value > 0) { %><div class="connect-cart-orderdiscount"><span>Discount: </span><span class="amount">-<%= formattedDiscount %></span></div> <%}%><% if (shippingAndHandling.value != null) { %><div class="connect-cart-orderdiscount"><span>Estimated Shipping: </span><span class="amount"><%= formattedShippingAndHandling %></span></div> <%}%><div class="connect-cart-subtotal"><span>Subtotal: </span><span class="amount"><%= formattedOrderTotal %></span></div><div class="connect-fine-print"><span>Excludes tax</span></div>',feedbackTemplate:'<p><i class="icon-ok-sign"></i> <%= msg %></p>',errorTemplate:'<p><i class="icon-warning-sign"></i> <%= msg %></p>',summaryElementSelector:"#drMiniCartSummary",cartElementSelector:"#drMiniCart",currency:["USD"],defaultCurrency:"USD"};return t.extend({init:function(){var e=this,t;e._super.apply(e,arguments),r.call(e,{qty:0,subtotal:"0.0"}),i.call(e),t=$(e.getOption("cartElementSelector")),t.on("change",".connect-cart-currencyselector",function(){var t=$(this).val();$(e).trigger("drconnect-changecurrency",[t])}),t.find(".connect-cart-showcode").on("click",function(e){e.preventDefault(),$(this).hide(),t.find(".connect-cart-couponwrapper").show().find("> input").select().focus()}),$("#couponCode").on("keypress paste",function(){var e=$(this);(e.val()!==""||e.val()!=null)&&e.parent(".connect-cart-couponwrapper").find('>a[class^="connect-"]').removeAttr("disabled")})},getDefaults:function(){return n},compileTemplates:function(){var t=this;t.compileSummaryTemplate(),t.compileCartOfferTemplate(),t.offerHeaderTemplate=e.template(t.getOption("offerHeaderTemplate")),t.compileProductTemplate(),t.compileSubtotalTemplate(),t.feedbackTemplate=e.template(t.getOption("feedbackTemplate")),t.errorTemplate=e.template(t.getOption("errorTemplate")),t.emptyCartTemplate=e.template(t.getOption("emptyCartTemplate"))},compileSummaryTemplate:function(){var t=this,n=$("#drMiniCartSummaryTemplate");n.length?t.summaryTemplate=e.template(n.html()):t.summaryTemplate=e.template(t.getOption("summaryTemplate"))},compileCartOfferTemplate:function(){var t=this,n=$("#drMiniCartOfferTemplate");n.length?t.cartOfferTemplate=e.template(n.html()):t.cartOfferTemplate=e.template(t.getOption("offerTemplate"))},compileProductTemplate:function(){var t=this,n=$("#drMiniCartProductTemplate");n.length?t.productTemplate=e.template(n.html()):t.productTemplate=e.template(t.getOption("productTemplate"))},compileSubtotalTemplate:function(){var t=this,n=$("#drMiniCartSubtotalTemplate");n.length?t.subtotalTemplate=e.template(n.html()):t.subtotalTemplate=e.template(t.getOption("subtotalTemplate"))},setOptions:function(e){e.summaryElement&&(e.summaryElementSelector="#"+e.summaryElement),e.cartElement&&(e.cartElementSelector="#"+e.cartElement),this._super.apply(this,[e])},updateCartSummary:function(e){var t=this,n=$(t.getOption("summaryElementSelector")),r={},i;r.qty=e.totalItemsInCart||"0",e.pricing!=null?r.subtotal=e.pricing.formattedOrderTotal:r.subtotal="0.0",n.length&&(i=t.summaryTemplate(r),n.html(i))},updateCart:function(e,t){var n=this,r=$(n.getOption("cartElementSelector"));e.lineItems&&e.lineItems.lineItem&&e.lineItems.lineItem.length?n.showLineItems(r,e):t.then(function(e){n.showEmptyCartOffers(r,e)}),$(n).trigger("drconnect-cartrender")},showLineItems:function(e,t){var n=this,r=[];e.find(".connect-cart-offerheader").hide().end().find(".connect-cart-totals").show().end().find(".connect-cart-footer").show().find(".connect-cart-showcode").show();try{r=t.lineItems.lineItem||[]}catch(i){}n.renderLineItems(e,r),n.setupEventListeners(e),n.updateCartSubtotal(t),$(n).trigger("drconnect-updatecart",[t])},renderLineItems:function(t,n){var r=this,i="";e.each(n,function(e){var t,n,s;if(e&&e.product!==undefined&&e.product.inventoryStatus!==undefined){t=e.product,n=e.product.inventoryStatus,s=parseInt(n.availableQuantity,10),isNaN(s)||(n.availableQuantity=s);if(t.maxOrderQuantity!==undefined)n.maxOrderQuantity=t.maxOrderQuantity;else if(n.productIsAllowsBackorders==="false"||n.productIsAllowsBackorders===!1)n.maxOrderQuantity=s-e.quantity;n.minOrderQuantity=t.minOrderQuantity||0}i+=r.productTemplate(e)}),t.find(".connect-cart-body .connect-content").empty().html(i).end()},setupEventListeners:function(e){var t=this;e.hasClass("initialized")||e.addClass("initialized").on("keypress",'input[type="text"]',function(e){e.keyCode===13&&$(t).trigger("drconnect-updatequantity",[this.value,this]),e.stopImmediatePropagation()}).on("click",".connect-cart-remove a",function(e){e.preventDefault(),$(t).trigger("drconnect-remove",[this])}).on("click",".connect-cart-applycoupon",function(){if(!$(this).attr("disabled")&&!$(this).hasClass("disabled")){var e=$("#couponCode").get(0);$(t).trigger("drconnect-applycoupon",[e,this])}return!1}).on("click",".connect-cart-buy",function(e){e.preventDefault();var n=this.value||this.href;$(t).trigger("drconnect-addtocart",[{value:n},this])}).on("click",".connect-cart-updatebtn",function(){var e=$(this),n;return!e.attr("disabled")&&!e.hasClass("disabled")&&(n=e.siblings('input[type="text"]'),n.length&&n.val()>-1&&$(t).trigger("drconnect-updatequantity",[n.val(),n.get(0)])),!1})},updateCartSubtotal:function(e){var t=this,n=e.pricing,r=$(t.getOption("cartElementSelector"));n&&n.formattedOrderTotal!=null?(n.discount&&typeof n.discount.value=="string"&&(isNaN(parseInt(n.discount.value,10))||(n.discount.value=parseInt(n.discount.value,10))),n.shippingAndHandling&&typeof n.shippingAndHandling.value=="string"&&(isNaN(parseInt(n.shippingAndHandling.value,10))||(n.shippingAndHandling.value=parseInt(n.shippingAndHandling.value,10))),r.find(".connect-cart-totals").empty().html(t.subtotalTemplate(n))):(n={formattedOrderTotal:"0.00",discount:{value:0},shippingAndHandling:{value:0}},r.find(".connect-cart-totals").empty().html(t.subtotalTemplate(n)))},showEmptyCartOffers:function(e,t){var n=this;n.renderEmptyOffers(e,t),e.find(".connect-cart-totals").hide().end().find(".connect-cart-couponwrapper").hide().end().find(".connect-cart-footer").hide(),n.setupEventListeners(e),$(n).trigger("drconnect-updatecart",[t])},renderEmptyOffers:function(e,t){var n=this,r="",i=[],s,o;try{i=t.productOffers.productOffer}catch(u){}if(i.length){t.salesPitch[0]&&e.find(".connect-cart-offerheader").show().html(n.offerHeaderTemplate({offerHeader:t.salesPitch[0]}));for(s=0,o=i.length;s<o;s+=1)r+=n.cartOfferTemplate(i[s])}else r=n.emptyCartTemplate();e.find(".connect-cart-body .connect-content").empty().html(r).end()},hideCouponEntry:function(){var e=this.getOptions(),t;t=$(e.cartElementSelector),t.find(".connect-cart-couponwrapper").hide().find('>a[class^="connect-"]').attr("disabled","disabled"),t.find(".connect-cart-showcode").show()},setCurrency:function(e){var t=this,n=$(t.getOption("cartElementSelector")),r;r=n.find(".connect-cart-currencyselector"),r.val(e)},blockCartUI:function(){var e=this,t=$(e.getOption("cartElementSelector"));t.find(".connect-cart-body").addClass("connect-loading").find(".connect-content").scrollTop(0).end().find(".connect-cart-currencyselector").attr("disabled","disabled")},unblockCartUI:function(){var e=this;$(e.getOption("cartElementSelector")).find(".connect-cart-body").removeClass("connect-loading").find(".connect-content").scrollTop(0).end().find(".connect-cart-currencyselector").removeAttr("disabled")},showFeedback:function(e,t){var n=this,r,i=$(n.getOption("cartElementSelector")),s=i.find(".connect-cart-feedback");t=!!t,r=t?n.errorTemplate({msg:e}):n.feedbackTemplate({msg:e}),n.feedbackTO!==null?(clearTimeout(n.feedbackTO),n.feedbackTO=null,n.hideFeedback(function(){s.toggleClass("connect-cart-error",t).html(r).fadeIn()})):s.toggleClass("connect-cart-error",t).html(r).fadeIn(),n.feedbackTO=setTimeout(function(){n.hideFeedback()},5e3)},hideFeedback:function(e){var t=this,n=$(t.getOption("cartElementSelector"));n.find(".connect-cart-feedback").fadeOut(function(){typeof e=="function"&&e.call(this)})},getCartElement:function(){return $(this.getOption("cartElementSelector"))}})}),define("dr-minicart",["api/Client","config","service/CartService","view/CartView","util/Class"],function(e,t,n,r,i){function o(e,t,n){var r=/\/?ProductID[=\.](\d+)\/?/i,i=/\/?Quantity[=\.](\d+)\/?/i;n===undefined&&(n=document),$(s,n).each(function(){var n=this.href.match(r)[1],s=i.test(this.href)?RegExp.$1:"1";$(this).on("click",function(r){var i=$(this);r.preventDefault(),i.addClass("disabled"),t.addLineItemToCartById(n,s,i.attr("href")).then(function(n){typeof n=="string"?window.location.href=n:(e.updateCartSummary(n),e.updateCart(n,t.getEmptyCartOffer()),i.removeClass("disabled"),e.showFeedback("Item added to cart"))},function(t){i.removeClass("disabled"),e.showFeedback(t.message,!0)})})})}var s='a[href*="AddItemToRequisition"],area[href*="AddItemToRequisition"],a[href*="/store/"][href*="/buy/"][href*="/productID."],area[href*="/store/"][href*="/buy/"][href*="/productID."]';return i.extend({defaults:{summaryElement:"drMiniCartSummary",cartElement:"drMiniCart",rewriteLinks:!0},init:function(t){var i=this,s,u,a,f;i.setOptions(t),a=i.getOptions(),a.client&&a.client instanceof e?i.client=a.client:a.apiKey&&(i.client=new e(a.apiKey)),s=new n(i.client),u=new r(t),a.rewriteLinks!==!1&&o.call(i,u,s),$(s).on("drconnect-beforeaddproduct drconnect-beforeremoveitem drconnect-beforequantityupdate drconnect-beforeapplycode",function(){u.blockCartUI()}).on("drconnect-carterror",function(){u.unblockCartUI()}),f=u.getCartElement(),$(u).on("drconnect-addtocart",function(e,t){s.addLineItemToCart(t.value).then(function(e){u.showFeedback("Item added to cart."),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer()),f.trigger("drconnect-addtocart",[e])},function(e){u.showFeedback(e.message,!0)})}).on("drconnect-updatequantity",function(e,t,n){var r=$(n).attr("data-lineitem-id");t!==n.defaultValue&&(!isNaN(t-0)&&t-0>0?r&&(f.trigger("drconnect-updatequantity",[r,t,n]),s.updateQuantity(r,t).then(function(e){u.showFeedback("Quantity Updated"),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer())},function(){u.showFeedback("Unable to Update",!0),n.value=n.defaultValue})):(u.showFeedback("Please enter a number greater than zero",!0),n.value=n.defaultValue))}).on("drconnect-remove",function(e,t){var n=$(t).attr("data-lineitem-id");n&&s.removeLineItem(n).then(function(e){f.trigger("drconnect-remove",[n]),u.showFeedback("Item removed"),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer())})}).on("drconnect-updatecart",function(e,t){u.unblockCartUI(),f.trigger("drconnect-updatecart",[t])}).on("drconnect-changecurrency",function(e,t){u.blockCartUI(),i.client.updateShopper({currency:t}).then(function(){f.trigger("drconnect-changecurrency",[t]),u.showFeedback("Currency Settings Updated");return},function(){u.showFeedback("Unable to update Currenct Settings",!0);return}).done(function(){s.clearCache(),s.getActiveCart().then(function(e){u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer())})})}).on("drconnect-applycoupon",function(e,t){var n=$(t).val();n!=null&&s.applyCouponCode(n).then(function(e){u.showFeedback("Coupon code applied. Final price will be determined at checkout."),$(t).val(""),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer()),u.hideCouponEntry()})}).on("drconnect-cartrender",function(){f.trigger("drconnect-cartrender")}),$(".connect-cart-checkout").on("click",function(){s.getWebCheckoutUrl().then(function(e){window.location=e})}),this.start(u,s)},start:function(e,n){var r=this;e.blockCartUI(),n.getActiveCart().then(function(i){i.pricing&&i.pricing.orderTotal?(e.updateCartSummary(i),e.updateCart(i,n.getEmptyCartOffer()),e.setCurrency(i.pricing.orderTotal.currency)):r.client.shopperService.list().then(function(s){s.currency?(e.updateCartSummary(i),e.updateCart(i,n.getEmptyCartOffer()),e.setCurrency(s.currency)):(e.setCurrency(t.getDefaultCurrency()),r.client.updateShopper({currency:t.getDefaultCurrency(),locale:t.getDefaultLocale()}).then(function(){e.updateCartSummary(i),e.updateCart(i,n.getEmptyCartOffer())}))})})},setOptions:function(e){var n=this;n.options=$.extend({},e),n.options.emptyOfferId&&t.setEmptyOfferId(n.options.emptyOfferId),n.options.emptyOfferPop&&t.setEmptyOfferPop(n.options.emptyOfferPop),n.options.siteId&&t.setSiteId(n.options.siteId),n.options.vanityDomain&&t.setVanityDomain(n.options.vanityDomain)},getOptions:function(){return this.options},setOption:function(e,t){this.options[e]=t},getOption:function(e){return this.options[e]}})});