/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

/**
 * An API Library for making JSON P calls without jQuery.
 * @author Christopher Pryce<cpryce@digitalriver.com>
 *
 * Based on JSON and JSONP By Angus Croll
 * http://javascriptweblog.wordpress.com/2010/11/29/json-and-jsonp/
 *
 * Copyright 2013 Christopher Pryce
 * No use restrictions. Code is distributed AS IS with no implicit or explicit warranty
 *
 *
 * Module definition
 * @dependencies Q or an other library that supports CommonJS Promises/A API
 */

/**
 * @license
 * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>
 * Build: `lodash underscore exports="amd,commonjs,global,node" -o ./dist/lodash.underscore.js`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../node_modules/almond/almond",function(){}),define("util/Class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,n=function(){};return n.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o},n}),define("config",[],function(){var e={env:"prod",connection:{},emptyOfferPop:"SiteMerchandising_EmptyCart",defaultCurrency:"USD",defaultLocale:"en_US",vanityDomain:"store.digitalriver.com"};return e.connection.URI={BASE_URL:null,DEV_BASE_URL:"http://23.21.197.49",SYS_BASE_URL:"http://23.21.197.49:2080",PRD_BASE_URL:"https://api.digitalriver.com",CTE_BASE_URL:"https://api-cte.digitalriver.com",VERSION:"v1",ANONYMOUS_LOGIN:"shoppers/token",CATEGORY_RESOURCE:"shoppers/me/categories",CART_RESOURCE:"shoppers/me/carts/active",OFFER_RESOURCE:"shoppers/me/point-of-promotions",WEB_CHECKOUT:"shoppers/me/carts/active/web-checkout",SHOPPER:"shoppers/me",HOME_PAGE_OFFER:"shoppers/me/point-of-promotions",LINE_ITEM_RESOURCE:"shoppers/me/carts/active/line-items",PRODUCT_RESOURCE:"shoppers/me/products"},{getBaseUrl:function(){var t=this,n=e.connection.URI,r;switch(t.getEnv()){case"dev":r=n.DEV_BASE_URL;break;case"sys":r=n.SYS_BASE_URL;break;case"cte":r=n.CTE_BASE_URL;break;case"prod":default:r=n.PRD_BASE_URL}return r},getHomePageOfferUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.OFFER_RESOURCE,e.homePagePop,"offers",e.homePageOfferId,"product-offers"].join("/")},getAnonymousLoginUri:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.ANONYMOUS_LOGIN].join("/")},getTokenServiceUri:function(e,t){var n=this,r=e||n.getDefaultLocale(),i=["Action=ShopDomain","Locale="+r,"SiteId="+t].join("&");return"https://"+n.getVanityDomain()+"/store?"+i},getCategoryResourceUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.CATEGORY_RESOURCE].join("/")},getCartResourceUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.CART_RESOURCE].join("/")},getWebCheckoutUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.WEB_CHECKOUT].join("/")},getEmptyOfferUrl:function(){var t=this,n=e.connection.URI;if(e.emptyOfferPop!=null&&e.emptyOfferId!=null)return[t.getBaseUrl(),n.VERSION,n.OFFER_RESOURCE,e.emptyOfferPop,"offers",e.emptyOfferId].join("/")},getLineItemUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.LINE_ITEM_RESOURCE].join("/")},getProductResourceURL:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.PRODUCT_RESOURCE].join("/")},getShopperUrl:function(){var t=this,n=e.connection.URI;return[t.getBaseUrl(),n.VERSION,n.SHOPPER].join("/")},getEnv:function(){return e.env},setEnv:function(t){e.env=t},getApiKey:function(){return e.apiKey},setApiKey:function(t){e.apiKey=t},getDefaultCurrency:function(){return e.defaultCurrency},setDefaultCurrency:function(t){e.defaultCurrency=t},getDefaultLocale:function(){return e.defaultLocale},setDefaultLocale:function(t){e.defaultLocale=t},getEmptyOfferId:function(){return e.emptyOfferId},setEmptyOfferId:function(t){e.emptyOfferId=t},getEmptyOfferPop:function(){return e.emptyOfferPop},setEmptyOfferPop:function(t){e.emptyOfferPop=t},getSiteId:function(){return e.siteId},setSiteId:function(t){e.siteId=t},getVanityDomain:function(){return e.vanityDomain},setVanityDomain:function(t){e.vanityDomain=t}}}),function(e){if(typeof bootstrap=="function")bootstrap("promise",e);else if(typeof exports=="object")module.exports=e();else if(typeof define=="function"&&define.amd)define("q",e);else if(typeof ses!="undefined"){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){function u(e){return function(){return o.apply(e,arguments)}}function m(e){return e===Object(e)}function g(e){return v(e)==="[object StopIteration]"||e instanceof y}function E(t,n){if(e&&n.stack&&typeof t=="object"&&t!==null&&t.stack&&t.stack.indexOf(w)===-1){var r=[];for(var i=n;!!i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(t.stack);var s=r.join("\n"+w+"\n");t.stack=S(s)}}function S(e){var t=e.split("\n"),n=[];for(var r=0;r<t.length;++r){var i=t[r];!N(i)&&!x(i)&&i&&n.push(i)}return n.join("\n")}function x(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function T(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);if(r)return[r[1],Number(r[2])]}function N(e){var t=T(e);if(!t)return!1;var i=t[0],s=t[1];return i===r&&s>=n&&s<=lt}function C(){if(!e)return;try{throw new Error}catch(t){var n=t.stack.split("\n"),i=n[0].indexOf("@")>0?n[1]:n[2],s=T(i);if(!s)return;return r=s[0],s[1]}}function k(e,t,n){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack),e.apply(e,arguments)}}function L(e){return H(e)?e:B(e)?G(e):Q(e)}function A(){function l(e){r=e,o.source=e,f(t,function(t,n){s(function(){e.promiseDispatch.apply(e,n)})},void 0),t=void 0,n=void 0}var t=[],n=[],r,i=h(A.prototype),o=h(_.prototype);o.promiseDispatch=function(e,i,o){var u=a(arguments);t?(t.push(u),i==="when"&&o[1]&&n.push(o[1])):s(function(){r.promiseDispatch.apply(r,u)})},o.valueOf=function(){if(t)return o;var e=P(r);return H(e)&&(r=e),e},o.inspect=function(){return r?r.inspect():{state:"pending"}};if(L.longStackSupport&&e)try{throw new Error}catch(u){o.stack=u.stack.substring(u.stack.indexOf("\n")+1)}return i.promise=o,i.resolve=function(e){if(r)return;l(L(e))},i.fulfill=function(e){if(r)return;l(Q(e))},i.reject=function(e){if(r)return;l(K(e))},i.notify=function(e){if(r)return;f(n,function(t,n){s(function(){n(e)})},void 0)},i}function O(e){if(typeof e!="function")throw new TypeError("resolver must be a function.");var t=A();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function M(e){return O(function(t,n){for(var r=0,i=e.length;r<i;r++)L(e[r]).then(t,n)})}function _(e,t,n){t===void 0&&(t=function(e){return K(new Error("Promise does not support operation: "+e))}),n===void 0&&(n=function(){return{state:"unknown"}});var r=h(_.prototype);r.promiseDispatch=function(n,i,s){var o;try{e[i]?o=e[i].apply(r,s):o=t.call(r,i,s)}catch(u){o=K(u)}n&&n(o)},r.inspect=n;if(n){var i=n();i.state==="rejected"&&(r.exception=i.reason),r.valueOf=function(){var e=n();return e.state==="pending"||e.state==="rejected"?r:e.value}}return r}function D(e,t,n,r){return L(e).then(t,n,r)}function P(e){if(H(e)){var t=e.inspect();if(t.state==="fulfilled")return t.value}return e}function H(e){return m(e)&&typeof e.promiseDispatch=="function"&&typeof e.inspect=="function"}function B(e){return m(e)&&typeof e.then=="function"}function j(e){return H(e)&&e.inspect().state==="pending"}function F(e){return!H(e)||e.inspect().state==="fulfilled"}function I(e){return H(e)&&e.inspect().state==="rejected"}function W(){!U&&typeof window!="undefined"&&window.console&&console.warn("[Q] Unhandled rejection reasons (should be empty):",q),U=!0}function X(){for(var e=0;e<q.length;e++){var t=q[e];console.warn("Unhandled rejection reason:",t)}}function V(){q.length=0,R.length=0,U=!1,z||(z=!0,typeof process!="undefined"&&process.on&&process.on("exit",X))}function $(e,t){if(!z)return;R.push(e),t&&typeof t.stack!="undefined"?q.push(t.stack):q.push("(no stack) "+t),W()}function J(e){if(!z)return;var t=l(R,e);t!==-1&&(R.splice(t,1),q.splice(t,1))}function K(e){var t=_({when:function(t){return t&&J(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return $(t,e),t}function Q(e){return _({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return t===null||t===void 0?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return d(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function G(e){var t=A();return s(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function Y(e){return _({isDef:function(){}},function(n,r){return it(e,n,r)},function(){return L(e).inspect()})}function Z(e,t,n){return L(e).spread(t,n)}function et(e){return function(){function t(e,t){var s;if(b){try{s=n[e](t)}catch(o){return K(o)}return s.done?s.value:D(s.value,r,i)}try{s=n[e](t)}catch(o){return g(o)?o.value:K(o)}return D(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"next"),i=t.bind(t,"throw");return r()}}function tt(e){L.done(L.async(e)())}function nt(e){throw new y(e)}function rt(e){return function(){return Z([this,st(arguments)],function(t,n){return e.apply(t,n)})}}function it(e,t,n){return L(e).dispatch(t,n)}function st(e){return D(e,function(e){var t=0,n=A();return f(e,function(r,i,s){var o;H(i)&&(o=i.inspect()).state==="fulfilled"?e[s]=o.value:(++t,D(i,function(r){e[s]=r,--t===0&&n.resolve(e)},n.reject,function(e){n.notify({index:s,value:e})}))},void 0),t===0&&n.resolve(e),n.promise})}function ot(e){return D(e,function(e){return e=c(e,L),D(st(c(e,function(e){return D(e,i,i)})),function(){return e})})}function ut(e){return L(e).allSettled()}function at(e,t){return L(e).then(void 0,void 0,t)}function ft(e,t){return L(e).nodeify(t)}var e=!1;try{throw new Error}catch(t){e=!!t.stack}var n=C(),r,i=function(){},s=function(){function o(){while(e.next){e=e.next;var t=e.task;e.task=void 0;var r=e.domain;r&&(e.domain=void 0,r.enter());try{t()}catch(s){if(i)throw r&&r.exit(),setTimeout(o,0),r&&r.enter(),s;setTimeout(function(){throw s},0)}r&&r.exit()}n=!1}var e={task:void 0,next:null},t=e,n=!1,r=void 0,i=!1;s=function(e){t=t.next={task:e,domain:i&&process.domain,next:null},n||(n=!0,r())};if(typeof process!="undefined"&&process.nextTick)i=!0,r=function(){process.nextTick(o)};else if(typeof setImmediate=="function")typeof window!="undefined"?r=setImmediate.bind(window,o):r=function(){setImmediate(o)};else if(typeof MessageChannel!="undefined"){var u=new MessageChannel;u.port1.onmessage=function(){r=a,u.port1.onmessage=o,o()};var a=function(){u.port2.postMessage(0)};r=function(){setTimeout(o,0),a()}}else r=function(){setTimeout(o,0)};return s}(),o=Function.call,a=u(Array.prototype.slice),f=u(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1)do{if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}while(1);for(;n<r;n++)n in this&&(t=e(t,this[n],n));return t}),l=u(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),c=u(Array.prototype.map||function(e,t){var n=this,r=[];return f(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0),r}),h=Object.create||function(e){function t(){}return t.prototype=e,new t},p=u(Object.prototype.hasOwnProperty),d=Object.keys||function(e){var t=[];for(var n in e)p(e,n)&&t.push(n);return t},v=u(Object.prototype.toString),y;typeof ReturnValue!="undefined"?y=ReturnValue:y=function(e){this.value=e};var b;try{new Function("(function* (){ yield 1; })"),b=!0}catch(t){b=!1}var w="From previous event:";L.resolve=L,L.nextTick=s,L.longStackSupport=!1,L.defer=A,A.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(a(arguments,1)):e.resolve(n)}},L.promise=O,L.passByCopy=function(e){return e},_.prototype.passByCopy=function(){return this},L.join=function(e,t){return L(e).join(t)},_.prototype.join=function(e){return L([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},L.race=M,_.prototype.race=function(){return this.then(L.race)},L.makePromise=_,_.prototype.toString=function(){return"[object Promise]"},_.prototype.then=function(e,t,n){function u(t){try{return typeof e=="function"?e(t):t}catch(n){return K(n)}}function a(e){if(typeof t=="function"){E(e,r);try{return t(e)}catch(n){return K(n)}}return K(e)}function f(e){return typeof n=="function"?n(e):e}var r=this,i=A(),o=!1;return s(function(){r.promiseDispatch(function(e){if(o)return;o=!0,i.resolve(u(e))},"when",[function(e){if(o)return;o=!0,i.resolve(a(e))}])}),r.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=f(e)}catch(r){n=!0;if(!L.onerror)throw r;L.onerror(r)}n||i.notify(t)}]),i.promise},L.when=D,_.prototype.thenResolve=function(e){return this.then(function(){return e})},L.thenResolve=function(e,t){return L(e).thenResolve(t)},_.prototype.thenReject=function(e){return this.then(function(){throw e})},L.thenReject=function(e,t){return L(e).thenReject(t)},L.nearer=P,L.isPromise=H,L.isPromiseAlike=B,L.isPending=j,_.prototype.isPending=function(){return this.inspect().state==="pending"},L.isFulfilled=F,_.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"},L.isRejected=I,_.prototype.isRejected=function(){return this.inspect().state==="rejected"};var q=[],R=[],U=!1,z=!0;L.resetUnhandledRejections=V,L.getUnhandledReasons=function(){return q.slice()},L.stopUnhandledRejectionTracking=function(){V(),typeof process!="undefined"&&process.on&&process.removeListener("exit",X),z=!1},V(),L.reject=K,L.fulfill=Q,L.master=Y,L.spread=Z,_.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},L.async=et,L.spawn=tt,L["return"]=nt,L.promised=rt,L.dispatch=it,_.prototype.dispatch=function(e,t){var n=this,r=A();return s(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},L.get=function(e,t){return L(e).dispatch("get",[t])},_.prototype.get=function(e){return this.dispatch("get",[e])},L.set=function(e,t,n){return L(e).dispatch("set",[t,n])},_.prototype.set=function(e,t){return this.dispatch("set",[e,t])},L.del=L["delete"]=function(e,t){return L(e).dispatch("delete",[t])},_.prototype.del=_.prototype["delete"]=function(e){return this.dispatch("delete",[e])},L.mapply=L.post=function(e,t,n){return L(e).dispatch("post",[t,n])},_.prototype.mapply=_.prototype.post=function(e,t){return this.dispatch("post",[e,t])},L.send=L.mcall=L.invoke=function(e,t){return L(e).dispatch("post",[t,a(arguments,2)])},_.prototype.send=_.prototype.mcall=_.prototype.invoke=function(e){return this.dispatch("post",[e,a(arguments,1)])},L.fapply=function(e,t){return L(e).dispatch("apply",[void 0,t])},_.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},L["try"]=L.fcall=function(e){return L(e).dispatch("apply",[void 0,a(arguments,1)])},_.prototype.fcall=function(){return this.dispatch("apply",[void 0,a(arguments)])},L.fbind=function(e){var t=L(e),n=a(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(a(arguments))])}},_.prototype.fbind=function(){var e=this,t=a(arguments);return function(){return e.dispatch("apply",[this,t.concat(a(arguments))])}},L.keys=function(e){return L(e).dispatch("keys",[])},_.prototype.keys=function(){return this.dispatch("keys",[])},L.all=st,_.prototype.all=function(){return st(this)},L.allResolved=k(ot,"allResolved","allSettled"),_.prototype.allResolved=function(){return ot(this)},L.allSettled=ut,_.prototype.allSettled=function(){return this.then(function(e){return st(c(e,function(e){function t(){return e.inspect()}return e=L(e),e.then(t,t)}))})},L.fail=L["catch"]=function(e,t){return L(e).then(void 0,t)},_.prototype.fail=_.prototype["catch"]=function(e){return this.then(void 0,e)},L.progress=at,_.prototype.progress=function(e){return this.then(void 0,void 0,e)},L.fin=L["finally"]=function(e,t){return L(e)["finally"](t)},_.prototype.fin=_.prototype["finally"]=function(e){return e=L(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},L.done=function(e,t,n,r){return L(e).done(t,n,r)},_.prototype.done=function(e,t,n){var r=function(e){s(function(){E(e,i);if(!L.onerror)throw e;L.onerror(e)})},i=e||t||n?this.then(e,t,n):this;typeof process=="object"&&process&&process.domain&&(r=process.domain.bind(r)),i.then(void 0,r)},L.timeout=function(e,t,n){return L(e).timeout(t,n)},_.prototype.timeout=function(e,t){var n=A(),r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},L.delay=function(e,t){return t===void 0&&(t=e,e=void 0),L(e).delay(t)},_.prototype.delay=function(e){return this.then(function(t){var n=A();return setTimeout(function(){n.resolve(t)},e),n.promise})},L.nfapply=function(e,t){return L(e).nfapply(t)},_.prototype.nfapply=function(e){var t=A(),n=a(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},L.nfcall=function(e){var t=a(arguments,1);return L(e).nfapply(t)},_.prototype.nfcall=function(){var e=a(arguments),t=A();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},L.nfbind=L.denodeify=function(e){var t=a(arguments,1);return function(){var n=t.concat(a(arguments)),r=A();return n.push(r.makeNodeResolver()),L(e).fapply(n).fail(r.reject),r.promise}},_.prototype.nfbind=_.prototype.denodeify=function(){var e=a(arguments);return e.unshift(this),L.denodeify.apply(void 0,e)},L.nbind=function(e,t){var n=a(arguments,2);return function(){function s(){return e.apply(t,arguments)}var r=n.concat(a(arguments)),i=A();return r.push(i.makeNodeResolver()),L(s).fapply(r).fail(i.reject),i.promise}},_.prototype.nbind=function(){var e=a(arguments,0);return e.unshift(this),L.nbind.apply(void 0,e)},L.nmapply=L.npost=function(e,t,n){return L(e).npost(t,n)},_.prototype.nmapply=_.prototype.npost=function(e,t){var n=a(t||[]),r=A();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},L.nsend=L.nmcall=L.ninvoke=function(e,t){var n=a(arguments,2),r=A();return n.push(r.makeNodeResolver()),L(e).dispatch("post",[t,n]).fail(r.reject),r.promise},_.prototype.nsend=_.prototype.nmcall=_.prototype.ninvoke=function(e){var t=a(arguments,1),n=A();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},L.nodeify=ft,_.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){s(function(){e(null,t)})},function(t){s(function(){e(t)})})};var lt=C();return L}),define("jsonp",["q"],function(e){var t={callbackCounter:0,getJSON:function(t,n,r){var i=e.defer(),s=this,o,u,a;return r=r||s,o="JSONPCallback_"+s.callbackCounter,s.callbackCounter+=1,window[o]=s.evalJSONP(i),t=t.replace("=callback","="+o),u=document.createElement("SCRIPT"),u.src=t,a=document.getElementsByTagName("HEAD")[0].appendChild(u),i.promise.then(function(e){window[o]=undefined;try{delete window[o]}catch(t){}try{a.parentNode.removeChild(a)}catch(t){}return e}).then(function(e){return typeof n=="function"&&n.call(r,e),e})},evalJSONP:function(e){return function(t){var n=!1;if(typeof t=="string")try{n=JSON.parse(t)}catch(r){}else n=JSON.parse(JSON.stringify(t));n?e.resolve(n):e.reject("JSONP call returned invalid or empty JSON")}}};return t}),define("connection/Connection",["jsonp"],function(e){var t=function(){};return t.prototype={create:function(e,t,n,r){return this.request(e,"POST",t,n,r)},retrieve:function(e,t,n,r){return this.request(e,"GET",t,n,r)},update:function(e,t,n){return this.request(e,"PUT",t,n)},remove:function(e,t,n){return this.request(e,"DELETE",t,n)},submitForm:function(e,t,n){return n=n||{},n["Content-Type"]="application/x-www-form-urlencoded",this.request(e,"POST",{},n,t)},request:function(t,n,r){n=n==null?"get":n.toLowerCase();if(r!=null){t+="?callback=callback&format=json&method="+n;for(var i in r)r.hasOwnProperty(i)&&(t+="&"+i+"="+r[i])}return e.getJSON(t)}},t}),define("connection/Session",["config","connection/Connection","q"],function(e,t,n){var r=function(e){var n=this;n.apiKey=e,n._connection=new t,n.reset()};return r.prototype={getAccess:function(e){if(!e||e!=="authenticated")return this.getLimitedAccess()},getLimitedAccess:function(){var e=this,t=e.getAccessToken(),r;return t?e.isTokenTimeStampValid()?r=n(t):r=e.anonymousLogin():r=e.anonymousLogin(),r},isTokenTimeStampValid:function(){var e=this,t=(new Date).getTime();return e.tokenExpirationTime&&e.tokenExpirationTime>t},doRefreshToken:function(e){return this.anonymousLogin(e)},anonymousLogin:function(t){var n=this,r=new Date,i=n.getLocale(),s=e.getSiteId(),o;return o=e.getTokenServiceUri(i,s),o+=o.indexOf("?")!==-1?"&callback=callback":"?callback=callback",n.pendingRequest==null&&(n.pendingRequest=n._connection.request(o,"GET").then(function(e){var t={ts:r.getTime(),apiKey:n.apiKey};return e.stickyParameters===null||e.stickyParameters===""?t.domain=e.shopDomain:(t.domain=e.shopDomain,t.cookie=e.stickyParameters),n.getAnnonymousAccessToken(t)})),n.pendingRequest},getAnnonymousAccessToken:function(t,n){var r=this,i=e.getAnonymousLoginUri();return r._connection.request(i,"GET",t).then(function(e){return r.connected=!0,r.setAccessToken(e.access_token),r.setRefreshToken(e.refresh_token),r.tokenStartTime=(new Date).getTime(),r.tokenExpirationTime=(new Date).getTime()+parseInt(e.expires_in*1e3,10),n&&typeof n.resolve=="function"&&n.resolve(e.access_token),r.pendingRequest=null,e.access_token}).fail(function(e){n&&typeof n.reject=="function"&&n.reject(e),r.reset(),r.pendingRequest=null})},updateShopperSession:function(t){var n=this;t&&(n._locale=t.Locale||e.getDefaultLocale())},reset:function(){var e=this;e.setAccessToken(null),e.setRefreshToken(null),e.connected=!1,e.tokenStartTime=null,e.tokenExpirationTime=null},getAccessToken:function(){return this._token},setAccessToken:function(e){this._token=e},getRefreshToken:function(){return this._refreshToken},setRefreshToken:function(e){this._refreshToken=e},getClient:function(){return this._client},getLocale:function(){return this._locale||e.getDefaultLocale()}},r}),define("service/BaseService",["util/Class","connection/Connection"],function(e,t){return e.extend({init:function(e){var n=this;n._client=e,n._connection=new t},list:function(e,t,n){var r=this;return e=e||r.uri,r._client.connect().then(function(i){var s=r._makeQueryParams({token:i},t);return r._connection.request(e,"GET",s,n)})},get:function(e,t,n){var r=this,i=[r.uri,e].join("/");return r._client.connect().then(function(e){var s=r._makeQueryParams({token:e},t);return r._connection.request(i,"GET",s,n)})},post:function(e,t){var n=this;return e=e||n.uri,n._client.connect().then(function(r){var i=n._makeQueryParams({token:r},t);return n._connection.request(e,"POST",i)})},remove:function(e,t){var n=this;return e=e||n.uri,n._client.connect().then(function(r){var i=n._makeQueryParams({token:r},t);return n._connection.request(e,"DELETE",i)})},_makeQueryParams:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}})}),define("service/Shopper",["util/Class","service/BaseService","config"],function(e,t,n){var r={currency:null,locale:null};return t.extend({init:function(){var e=this;e._super.apply(this,arguments),e.uri=n.getShopperUrl()},list:function(){var e=this;return e._super.apply(e,[e.uri,{expand:"currency,locale"}])},updateShopper:function(e){var t=this,i=n.getShopperUrl();return e==null&&(e={}),e.currency=e.currency||n.getDefaultCurrency(),e.locale=e.locale||n.getDefaultLocale(),t.post(i,e).then(function(t){return t.success&&(r.currency=e.currency,r.locale=e.locale),r})}})}),define("api/Client",["util/Class","connection/Session","service/Shopper"],function(e,t,n){return e.extend({init:function(e){var r=this;r._session=new t(e),r.shopperService=new n(r)},connect:function(){var e=this,t=e._session;return $(e).trigger("drconnect-beforeconnect",[e]),t.getAccess()},disconnect:function(){this._session.reset()},getSession:function(){return this._session},updateShopper:function(e){var t=this;return this.shopperService.updateShopper(e).then(function(e){return t._session.updateShopperSession(e),e},function(e){throw e})}})}),define("util/util",[],function(){var e={};return e.getAttribute=function(e,t){var n=t.split("."),r=e,i="";for(var s=0,o=n.length;s<o;s++)i=n[s],r[i]=r[i]||{},r=r[i];return r},e.setAttribute=function(e,t,n){var r=t.split("."),i=e,s="";for(var o=0,u=r.length;o<u-1;o++)s=r[o],i[s]=i[s]||{},i=i[s];i[r[u-1]]=n},e.getQueryStringParam=function(e,t){var n=(new RegExp("[\\?&]"+t+"=([^&#]*)")).exec(e);return n?n[1]||0:""},e.getCurrentPath=function(){var e=window.location.href.replace(window.location.hash,"");return e.substring(0,e.lastIndexOf("/"))},e}),define("service/CartService",["util/Class","service/BaseService","config","q","util/util"],function(e,t,n,r,i){var s=null;return t.extend({init:function(){var e=this;e._super.apply(e,arguments),e.uri=n.getCartResourceUrl()},getActiveCart:function(){return this.list(n.getCartResourceUrl(),{expand:"pricing.all,lineitems.lineitem.product,lineitems.lineitem.pricing.all,shippingOptions,shippingMethods"}).then(function(e){return e.cart})},getEmptyCartOffer:function(){var e;return s===null&&n.getEmptyOfferUrl()!=null?e=this.list(n.getEmptyOfferUrl(),{expand:"productOffers.productOffer.addProductToCart"}).then(function(e){return s=e.offer,s},function(){e=null}):e=r(s),e},applyCouponCode:function(e){var t=this;if($(t).triggerHandler("drconnect-beforeapplycode",[e])!==!1)return t.post(null,{promoCode:e}).then(function(){return t.getActiveCart()},function(){return t.getActiveCart()})},addLineItemToCart:function(e){var t=this,r=i.getQueryStringParam(e,"productId"),s=[n.getProductResourceURL(),r].join("/");if($(t).triggerHandler("drconnect-beforeaddproduct",[e])!==!1)return t.list(s).then(function(n){if(n.product&&n.product.variations&&n.product.variations.product)throw $(t).trigger("drconnect-carterror",["Base  products can't be purchased."]),"Cannot add product to cart.";return t.post(e).then(function(){return t.getActiveCart()},function(e){throw $(t).trigger("drconnect-carterror",[e]),e})},function(e){throw $(t).trigger("drconnect-carterror",[e]),e})},addLineItemToCartById:function(e,t,i){var s=this,o=[n.getProductResourceURL(),e].join("/");t=t||1;if($(s).triggerHandler("drconnect-beforeaddproduct",[o])!==!1)return s.list(o).then(function(o){return o.product&&o.product.variations&&o.product.variations.product?r(i):s.post(n.getLineItemUrl(),{productId:e,quantity:t}).then(function(){return s.getActiveCart()},function(e){throw e.message="Unable to Add Item to cart",$(s).trigger("drconnect-carterror",[e]),e})},function(e){throw e.message="Unable to Add Item to cart",$(s).trigger("drconnect-carterror",[e]),e})},updateQuantity:function(e,t){var r=this,i=[n.getCartResourceUrl(),"line-items",e].join("/");if($(r).triggerHandler("drconnect-beforequantityupdate",[t,e])!==!1)return r.post(i,{quantity:t,expand:"all"}).then(function(){return $(r).trigger("drconnect-quantityupdate",[t,e]),r.getActiveCart()},function(e){throw $(r).trigger("drconnect-carterror",[e]),e})},removeLineItem:function(e){var t=this,r=[n.getCartResourceUrl(),"line-items",e].join("/");if($(t).triggerHandler("drconnect-beforeremoveitem",[e])!==!1)return t.remove(r).then(function(){return t.getActiveCart()},function(){return t.getActiveCart()})},getWebCheckoutUrl:function(){return this._client.connect().then(function(e){return n.getWebCheckoutUrl()+"?token="+e},function(){return"Unable to checkout"})},clearCache:function(){s=null}})}),function(){function x(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i)if(e[r]===t)return r;return-1}function T(e,t){var n=e.criteria,r=t.criteria,i=-1,s=n.length;while(++i<s){var o=n[i],u=r[i];if(o!==u){if(o>u||typeof o=="undefined")return 1;if(o<u||typeof u=="undefined")return-1}}return e.index-t.index}function N(e){return"\\"+g[e]}function C(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}function X(e){return e instanceof X?e:new V(e)}function V(e,t){this.__chain__=!!t,this.__wrapped__=e}function J(e){function i(){if(n){var e=C(n);H.apply(e,arguments)}if(this instanceof i){var s=K(t.prototype),o=t.apply(s,e||arguments);return _t(o)?o:s}return t.apply(r,e||arguments)}var t=e[0],n=e[2],r=e[4];return i}function K(e,t){return _t(e)?j(e):{}}function Q(e,t,n){if(typeof e!="function")return Vn;if(typeof t!="undefined"&&"prototype"in e){switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Dn(e,t)}return e}function G(e){function h(){var e=u?s:this;if(r){var p=C(r);H.apply(p,arguments)}if(i||f){p||(p=C(arguments)),i&&H.apply(p,i);if(f&&p.length<o)return n|=16,G([t,l?n:n&-4,p,null,s,o])}p||(p=arguments),a&&(t=e[c]);if(this instanceof h){e=K(t.prototype);var d=t.apply(e,p);return _t(d)?d:e}return t.apply(e,p)}var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=n&1,a=n&2,f=n&4,l=n&8,c=t;return h}function Y(e,t){var n=-1,r=ot(),i=e?e.length:0,s=[];while(++n<i){var o=e[n];r(t,o)<0&&s.push(o)}return s}function Z(e,t,n,r){var i=(r||0)-1,s=e?e.length:0,o=[];while(++i<s){var u=e[i];if(u&&typeof u=="object"&&typeof u.length=="number"&&(lt(u)||ft(u))){t||(u=Z(u,t,n));var a=-1,f=u.length,l=o.length;o.length+=f;while(++a<f)o[l++]=u[a]}else n||o.push(u)}return o}function et(e,t,r,i){if(e===t)return e!==0||1/e==1/t;var s=typeof e,o=typeof t;if(e===e&&(!e||!m[s])&&(!t||!m[o]))return!1;if(e==null||t==null)return e===t;var u=O.call(e),c=O.call(t);if(u!=c)return!1;switch(u){case f:case l:return+e==+t;case h:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case d:case v:return e==String(t)}var g=u==a;if(!g){var y=e instanceof X,b=t instanceof X;if(y||b)return et(y?e.__wrapped__:e,b?t.__wrapped__:t,r,i);if(u!=p)return!1;var w=e.constructor,E=t.constructor;if(w!=E&&!(Mt(w)&&w instanceof w&&Mt(E)&&E instanceof E)&&"constructor"in e&&"constructor"in t)return!1}r||(r=[]),i||(i=[]);var S=r.length;while(S--)if(r[S]==e)return i[S]==t;var x=!0,T=0;r.push(e),i.push(t);if(g){T=t.length,x=T==e.length;if(x)while(T--)if(!(x=et(e[T],t[T],r,i)))break}else wt(t,function(t,s,o){if(P.call(o,s))return T++,!(x=P.call(e,s)&&et(e[s],t,r,i))&&n}),x&&wt(e,function(e,t,r){if(P.call(r,t))return!(x=--T>-1)&&n});return r.pop(),i.pop(),x}function tt(e,t){return e+D(W()*(t-e+1))}function nt(e,t,n){var r=-1,i=ot(),s=e?e.length:0,o=[],u=n?[]:o;while(++r<s){var a=e[r],f=n?n(a,r,e):a;if(t?!r||u[u.length-1]!==f:i(u,f)<0)n&&u.push(f),o.push(a)}return o}function rt(e){return function(t,n,r){var i={};n=Wn(n,r,3);var s=-1,o=t?t.length:0;if(typeof o=="number")while(++s<o){var u=t[s];e(i,u,n(u,s,t),t)}else Et(t,function(t,r,s){e(i,t,n(t,r,s),s)});return i}}function it(e,t,n,r,i,s){var o=t&1,u=t&2,a=t&4,f=t&8,l=t&16,c=t&32;if(!u&&!Mt(e))throw new TypeError;l&&!n.length&&(t&=-17,l=n=!1),c&&!r.length&&(t&=-33,c=r=!1);var h=t==1||t===17?J:G;return h([e,t,n,r,i,s])}function st(e){return pt[e]}function ot(){var e=(e=X.indexOf)===bn?x:e;return e}function ut(e){return typeof e=="function"&&M.test(e)}function at(e){return dt[e]}function ft(e){return e&&typeof e=="object"&&typeof e.length=="number"&&O.call(e)==u||!1}function gt(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)e[i]=r[i]}return e}function yt(e){return _t(e)?lt(e)?C(e):gt({},e):e}function bt(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)typeof e[i]=="undefined"&&(e[i]=r[i])}return e}function St(e){var t=[];return wt(e,function(e,n){Mt(e)&&t.push(n)}),t.sort()}function xt(e,t){return e?P.call(e,t):!1}function Tt(e){var t=-1,n=ht(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function Nt(e){return e===!0||e===!1||e&&typeof e=="object"&&O.call(e)==f||!1}function Ct(e){return e&&typeof e=="object"&&O.call(e)==l||!1}function kt(e){return e&&e.nodeType===1||!1}function Lt(e){if(!e)return!0;if(lt(e)||jt(e))return!e.length;for(var t in e)if(P.call(e,t))return!1;return!0}function At(e,t){return et(e,t)}function Ot(e){return I(e)&&!q(parseFloat(e))}function Mt(e){return typeof e=="function"}function _t(e){return!!e&&!!m[typeof e]}function Dt(e){return Ht(e)&&e!=+e}function Pt(e){return e===null}function Ht(e){return typeof e=="number"||e&&typeof e=="object"&&O.call(e)==h||!1}function Bt(e){return e&&m[typeof e]&&O.call(e)==d||!1}function jt(e){return typeof e=="string"||e&&typeof e=="object"&&O.call(e)==v||!1}function Ft(e){return typeof e=="undefined"}function It(e){var t=[];wt(e,function(e,n){t.push(n)}),t=Y(t,Z(arguments,!0,!1,1));var n=-1,r=t.length,i={};while(++n<r){var s=t[n];i[s]=e[s]}return i}function qt(e){var t=-1,n=ht(e),r=n.length,i=Array(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function Rt(e){var t=-1,n=Z(arguments,!0,!1,1),r=n.length,i={};while(++t<r){var s=n[t];s in e&&(i[s]=e[s])}return i}function Ut(e){var t=-1,n=ht(e),r=n.length,i=Array(r);while(++t<r)i[t]=e[n[t]];return i}function zt(e,t){var r=ot(),i=e?e.length:0,s=!1;return i&&typeof i=="number"?s=r(e,t)>-1:Et(e,function(e){return(s=e===t)&&n}),s}function Xt(e,t,r){var i=!0;t=Wn(t,r,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o)if(!(i=!!t(e[s],s,e)))break}else Et(e,function(e,r,s){return!(i=!!t(e,r,s))&&n});return i}function Vt(e,t,n){var r=[];t=Wn(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number")while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}else Et(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function $t(e,t,r){t=Wn(t,r,3);var i=-1,s=e?e.length:0;if(typeof s!="number"){var u;return Et(e,function(e,r,i){if(t(e,r,i))return u=e,n}),u}while(++i<s){var o=e[i];if(t(o,i,e))return o}}function Jt(e,t){return dn(e,t,!0)}function Kt(e,t,r){var i=-1,s=e?e.length:0;t=t&&typeof r=="undefined"?t:Q(t,r,3);if(typeof s=="number"){while(++i<s)if(t(e[i],i,e)===n)break}else Et(e,t)}function Qt(e,t){var r=e?e.length:0;if(typeof r=="number"){while(r--)if(t(e[r],r,e)===!1)break}else{var i=ht(e);r=i.length,Et(e,function(e,s,o){return s=i?i[--r]:--r,t(o[s],s,o)===!1&&n})}}function Zt(e,t){var n=C(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Array(typeof s=="number"?s:0);return Kt(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)}),o}function en(e,t,n){var r=-1,i=e?e.length:0;t=Wn(t,n,3);if(typeof i=="number"){var s=Array(i);while(++r<i)s[r]=t(e[r],r,e)}else s=[],Et(e,function(e,n,i){s[++r]=t(e,n,i)});return s}function tn(e,t,n){var r=-Infinity,i=r;typeof t!="function"&&n&&n[t]===e&&(t=null);var s=-1,o=e?e.length:0;if(t==null&&typeof o=="number")while(++s<o){var u=e[s];u>i&&(i=u)}else t=Wn(t,n,3),Kt(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function nn(e,t,n){var r=Infinity,i=r;typeof t!="function"&&n&&n[t]===e&&(t=null);var s=-1,o=e?e.length:0;if(t==null&&typeof o=="number")while(++s<o){var u=e[s];u<i&&(i=u)}else t=Wn(t,n,3),Kt(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function sn(e,t,n,r){if(!e)return n;var i=arguments.length<3;t=Wn(t,r,4);var s=-1,o=e.length;if(typeof o=="number"){i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else Et(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function on(e,t,n,r){var i=arguments.length<3;return t=Wn(t,r,4),Qt(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)}),n}function un(e,t,n){return t=Wn(t,n,3),Vt(e,function(e,n,r){return!t(e,n,r)})}function an(t,n,r){t&&typeof t.length!="number"&&(t=Ut(t));if(n==null||r)return t?t[tt(0,t.length-1)]:e;var i=fn(t);return i.length=z(U(0,n),i.length),i}function fn(e){var t=-1,n=e?e.length:0,r=Array(typeof n=="number"?n:0);return Kt(e,function(e){var n=tt(0,++t);r[t]=r[n],r[n]=e}),r}function ln(e){var t=e?e.length:0;return typeof t=="number"?t:ht(e).length}function cn(e,t,r){var i;t=Wn(t,r,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o)if(i=t(e[s],s,e))break}else Et(e,function(e,r,s){return(i=t(e,r,s))&&n});return!!i}function hn(e,t,n){var r=-1,i=e?e.length:0,s=Array(typeof i=="number"?i:0);t=Wn(t,n,3),Kt(e,function(e,n,i){s[++r]={criteria:[t(e,n,i)],index:r,value:e}}),i=s.length,s.sort(T);while(i--)s[i]=s[i].value;return s}function pn(e){return lt(e)?C(e):e&&typeof e.length=="number"?en(e):Ut(e)}function dn(t,n,r){return r&&Lt(n)?e:(r?$t:Vt)(t,n)}function vn(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function mn(e){return Y(e,Z(arguments,!0,!0,1))}function gn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=-1;n=Wn(n,r,3);while(++o<s&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[0]:e}return C(t,0,z(U(0,i),s))}function yn(e,t){return Z(e,t)}function bn(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?U(0,r+n):n||0}else if(n){var i=Cn(e,t);return e[i]===t?i:-1}return x(e,t,n)}function wn(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=i;t=Wn(t,n,3);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return C(e,0,z(U(0,i-r),i))}function En(){var e=[],t=-1,n=arguments.length;while(++t<n){var r=arguments[t];(lt(r)||ft(r))&&e.push(r)}var i=e[0],s=-1,o=ot(),u=i?i.length:0,a=[];e:while(++s<u){r=i[s];if(o(a,r)<0){var t=n;while(--t)if(o(e[t],r)<0)continue e;a.push(r)}}return a}function Sn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=s;n=Wn(n,r,3);while(o--&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[s-1]:e}return C(t,U(0,s-i))}function xn(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?U(0,r+n):z(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function Tn(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var r=-1,i=U(0,_((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s}function Nn(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=Wn(t,n,3);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:U(0,t);return C(e,r)}function Cn(e,t,n,r){var i=0,s=e?e.length:i;n=n?Wn(n,r,1):Vn,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function kn(){return nt(Z(arguments,!0,!0))}function Ln(e,t,n,r){return typeof t!="boolean"&&t!=null&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),n!=null&&(n=Wn(n,r,3)),nt(e,t,n)}function An(e){return Y(e,C(arguments,1))}function On(){var e=-1,t=tn(rn(arguments,"length")),n=Array(t<0?0:t);while(++e<t)n[e]=rn(arguments,e);return n}function Mn(e,t){var n=-1,r=e?e.length:0,i={};!t&&r&&!lt(e[0])&&(t=[]);while(++n<r){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function _n(e,t){if(!Mt(t))throw new TypeError;return function(){if(--e<1)return t.apply(this,arguments)}}function Dn(e,t){return arguments.length>2?it(e,17,C(arguments,2),null,t):it(e,1,null,null,t)}function Pn(e){var t=arguments.length>1?Z(arguments,!0,!1,1):St(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=it(e[i],1,null,null,e)}return e}function Hn(){var e=arguments,t=e.length;while(t--)if(!Mt(e[t]))throw new TypeError;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function Bn(t,n,r){var i,s,o,u,a,f,l,c=0,h=!1,p=!0;if(!Mt(t))throw new TypeError;n=U(0,n)||0;if(r===!0){var d=!0;p=!1}else _t(r)&&(d=r.leading,h="maxWait"in r&&(U(n,r.maxWait)||0),p="trailing"in r?r.trailing:p);var v=function(){var r=n-(Qn()-u);if(r<=0){s&&clearTimeout(s);var h=l;s=f=l=e,h&&(c=Qn(),o=t.apply(a,i),!f&&!s&&(i=a=null))}else f=setTimeout(v,r)},m=function(){f&&clearTimeout(f),s=f=l=e;if(p||h!==n)c=Qn(),o=t.apply(a,i),!f&&!s&&(i=a=null)};return function(){i=arguments,u=Qn(),a=this,l=p&&(f||!d);if(h===!1)var e=d&&!f;else{!s&&!d&&(c=u);var r=h-(u-c),g=r<=0;g?(s&&(s=clearTimeout(s)),c=u,o=t.apply(a,i)):s||(s=setTimeout(m,r))}return g&&f?f=clearTimeout(f):!f&&n!==h&&(f=setTimeout(v,n)),e&&(g=!0,o=t.apply(a,i)),g&&!f&&!s&&(i=a=null),o}}function jn(t){if(!Mt(t))throw new TypeError;var n=C(arguments,1);return setTimeout(function(){t.apply(e,n)},1)}function Fn(t,n){if(!Mt(t))throw new TypeError;var r=C(arguments,2);return setTimeout(function(){t.apply(e,r)},n)}function In(e,t){var n={};return function(){var i=t?t.apply(this,arguments):r+arguments[0];return P.call(n,i)?n[i]:n[i]=e.apply(this,arguments)}}function qn(e){var t,n;if(!Mt(e))throw new TypeError;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Rn(e){return it(e,16,C(arguments,1))}function Un(e,t,n){var r=!0,i=!0;if(!Mt(e))throw new TypeError;return n===!1?r=!1:_t(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),n={},n.leading=r,n.maxWait=t,n.trailing=i,Bn(e,t,n)}function zn(e,t){return it(t,16,[e])}function Wn(e,t,n){var r=typeof e;if(e==null||r=="function")return Q(e,t,n);if(r!="object")return Gn(e);var i=ht(e);return function(t){var n=i.length,r=!1;while(n--)if(!(r=t[i[n]]===e[i[n]]))break;return r}}function Xn(e){return e==null?"":String(e).replace(mt,st)}function Vn(e){return e}function $n(e){Kt(St(e),function(t){var n=X[t]=e[t];X.prototype[t]=function(){var e=[this.__wrapped__];H.apply(e,arguments);var t=n.apply(X,e);return this.__chain__?new V(t,!0):t}})}function Jn(){return y._=A,this}function Kn(){}function Gn(e){return function(t){return t[e]}}function Yn(e,t){return e==null&&t==null&&(t=1),e=+e||0,t==null?(t=e,e=0):t=+t||0,e+D(W()*(t-e+1))}function Zn(e,t){if(e){var n=e[t];return Mt(n)?e[t]():n}}function er(e,t,n){var r=X,i=r.templateSettings;e=String(e||""),n=bt({},n,i);var u=0,a="__p += '",f=n.variable,l=RegExp((n.escape||s).source+"|"+(n.interpolate||s).source+"|"+(n.evaluate||s).source+"|$","g");e.replace(l,function(t,n,r,i,s){return a+=e.slice(u,s).replace(o,N),n&&(a+="' +\n_.escape("+n+") +\n'"),i&&(a+="';\n"+i+";\n__p += '"),r&&(a+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=s+t.length,t}),a+="';\n",f||(f="obj",a="with ("+f+" || {}) {\n"+a+"\n}\n"),a="function("+f+") {\n"+"var __t, __p = '', __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n"+a+"return __p\n}";try{var c=Function("_","return "+a)(r)}catch(h){throw h.source=a,h}return t?c(t):(c.source=a,c)}function tr(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=Array(e);t=Q(t,n,1);while(++r<e)i[r]=t(r);return i}function nr(e){return e==null?"":String(e).replace(vt,at)}function rr(e){var n=++t+"";return e?e+n:n}function ir(e){return e=new V(e),e.__chain__=!0,e}function sr(e,t){return t(e),e}function or(){return this.__chain__=!0,this}function ur(){return this.__wrapped__}var e,t=0,n={},r=+(new Date)+"",i=/<%=([\s\S]+?)%>/g,s=/($^)/,o=/['\n\r\t\u2028\u2029\\]/g,u="[object Arguments]",a="[object Array]",f="[object Boolean]",l="[object Date]",c="[object Function]",h="[object Number]",p="[object Object]",d="[object RegExp]",v="[object String]",m={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},g={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},y=m[typeof window]&&window||this,b=m[typeof exports]&&exports&&!exports.nodeType&&exports,w=m[typeof module]&&module&&!module.nodeType&&module,E=w&&w.exports===b&&b,S=m[typeof global]&&global;S&&(S.global===S||S.window===S)&&(y=S);var k=[],L=Object.prototype,A=y._,O=L.toString,M=RegExp("^"+String(O).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),_=Math.ceil,D=Math.floor,P=L.hasOwnProperty,H=k.push,B=L.propertyIsEnumerable,j=ut(j=Object.create)&&j,F=ut(F=Array.isArray)&&F,I=y.isFinite,q=y.isNaN,R=ut(R=Object.keys)&&R,U=Math.max,z=Math.min,W=Math.random;V.prototype=X.prototype;var $={};(function(){var e={0:1,length:1};$.spliceObjects=(k.splice.call(e,0,1),!e[0])})(1),X.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:i,variable:""},j||(K=function(){function e(){}return function(t){if(_t(t)){e.prototype=t;var n=new e;e.prototype=null}return n||y.Object()}}()),ft(arguments)||(ft=function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&P.call(e,"callee")&&!B.call(e,"callee")||!1});var lt=F||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&O.call(e)==a||!1},ct=function(e){var t,n=e,r=[];if(!n)return r;if(!m[typeof e])return r;for(t in n)P.call(n,t)&&r.push(t);return r},ht=R?function(e){return _t(e)?R(e):[]}:ct,pt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},dt=Tt(pt),vt=RegExp("("+ht(dt).join("|")+")","g"),mt=RegExp("["+ht(pt).join("")+"]","g"),wt=function(e,t){var r,i=e,s=i;if(!i)return s;if(!m[typeof i])return s;for(r in i)if(t(i[r],r,e)===n)return s;return s},Et=function(e,t){var r,i=e,s=i;if(!i)return s;if(!m[typeof i])return s;for(r in i)if(P.call(i,r)&&t(i[r],r,e)===n)return s;return s};Mt(/x/)&&(Mt=function(e){return typeof e=="function"&&O.call(e)==c});var Wt=rt(function(e,t,n){P.call(e,n)?e[n]++:e[n]=1}),Gt=rt(function(e,t,n){(P.call(e,n)?e[n]:e[n]=[]).push(t)}),Yt=rt(function(e,t,n){e[n]=t}),rn=en,Qn=ut(Qn=Date.now)&&Qn||function(){return(new Date).getTime()};X.after=_n,X.bind=Dn,X.bindAll=Pn,X.chain=ir,X.compact=vn,X.compose=Hn,X.countBy=Wt,X.debounce=Bn,X.defaults=bt,X.defer=jn,X.delay=Fn,X.difference=mn,X.filter=Vt,X.flatten=yn,X.forEach=Kt,X.functions=St,X.groupBy=Gt,X.indexBy=Yt,X.initial=wn,X.intersection=En,X.invert=Tt,X.invoke=Zt,X.keys=ht,X.map=en,X.max=tn,X.memoize=In,X.min=nn,X.omit=It,X.once=qn,X.pairs=qt,X.partial=Rn,X.pick=Rt,X.pluck=rn,X.range=Tn,X.reject=un,X.rest=Nn,X.shuffle=fn,X.sortBy=hn,X.tap=sr,X.throttle=Un,X.times=tr,X.toArray=pn,X.union=kn,X.uniq=Ln,X.values=Ut,X.where=dn,X.without=An,X.wrap=zn,X.zip=On,X.collect=en,X.drop=Nn,X.each=Kt,X.extend=gt,X.methods=St,X.object=Mn,X.select=Vt,X.tail=Nn,X.unique=Ln,X.clone=yt,X.contains=zt,X.escape=Xn,X.every=Xt,X.find=$t,X.has=xt,X.identity=Vn,X.indexOf=bn,X.isArguments=ft,X.isArray=lt,X.isBoolean=Nt,X.isDate=Ct,X.isElement=kt,X.isEmpty=Lt,X.isEqual=At,X.isFinite=Ot,X.isFunction=Mt,X.isNaN=Dt,X.isNull=Pt,X.isNumber=Ht,X.isObject=_t,X.isRegExp=Bt,X.isString=jt,X.isUndefined=Ft,X.lastIndexOf=xn,X.mixin=$n,X.noConflict=Jn,X.random=Yn,X.reduce=sn,X.reduceRight=on,X.result=Zn,X.size=ln,X.some=cn,X.sortedIndex=Cn,X.template=er,X.unescape=nr,X.uniqueId=rr,X.all=Xt,X.any=cn,X.detect=$t,X.findWhere=Jt,X.foldl=sn,X.foldr=on,X.include=zt,X.inject=sn,X.first=gn,X.last=Sn,X.sample=an,X.take=gn,X.head=gn,$n(X),X.VERSION="2.4.1",X.prototype.chain=or,X.prototype.value=ur,Kt(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=k[e];X.prototype[e]=function(){var e=this.__wrapped__;return t.apply(e,arguments),!$.spliceObjects&&e.length===0&&delete e[0],this}}),Kt(["concat","join","slice"],function(e){var t=k[e];X.prototype[e]=function(){var e=this.__wrapped__,n=t.apply(e,arguments);return this.__chain__&&(n=new V(n),n.__chain__=!0),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(y._=X,define("underscore",[],function(){return X})):b&&w?E?(w.exports=X)._=X:b._=X:y._=X}.call(this),define("view/BaseView",["util/Class"],function(e){return e.extend({init:function(e){var t=this;t.setOptions(e),t.compileTemplates()},compileTemplates:function(){},setOptions:function(e){var t=this;t.options=$.extend({},t.getDefaults(),e)},getOptions:function(){var e=this;return e.options?e.options:{}},getOption:function(e){var t=this;return t.options[e]},setOption:function(e,t){var n=this;n.options[e]=t},getDefaults:function(){return{}}})}),define("view/CartView",["underscore","view/BaseView"],function(e,t){function r(e){var t=this,n=t.getOptions();$(n.summaryElementSelector).append(t.summaryTemplate(e))}function i(){var t=this,n=t.getOptions(),r=$('<div class="connect-cart-wrapper"></div>').appendTo(n.cartElementSelector),i,s,o,u,a,f;i=$("#drMiniCartHeaderTemplate"),i.length?i=i.get(0).html():i=e.template(n.cartHeaderTemplate),r.prepend(i),e.each(n.currency,function(e){var t=$('<option value="'+e+'">'+e+"</option>");e===n.defaultCurrency&&t.attr("selected","selected"),r.find(".connect-cart-currencyselector").append(t)}),s=$("#drMiniCartBodyTemplate"),s.length?(f=n.emptyCartTemplate,s=s.get(0).html()):(f=n.emptyCartTemplate,s=e.template(n.bodyTemplate,{emptyCartMessage:f})),r.append(s),o=$("#drMiniCartTotalTemplate"),o.length?o=o.get(0).html():o=e.template(n.totalsTemplate),r.append(o),u=$("#drMiniCartCouponTemplate"),u.length?u=u.get(0).html():u=e.template(n.couponTemplate),r.append(u),a=$("#drMiniCartFooterTemplate"),a.length?a=e.template(a.html()):a=e.template(n.footerTemplate),r.append(a)}console.log(e);var n={summaryTemplate:'<div class="connect-cart-summary"><h3><span>Shopping Cart</span> (<span class="connect-cart-quantity"><%= qty %></span>)</h3></div>',cartTemplate:'<div id="drMiniCart" class="connect-mini-cart"></div>',cartHeaderTemplate:'<div class="connect-cart-header">   <div class="connect-cart-feedback"></div>   <div class="connect-cart-currency">       <label for="drCartCurrencySelector">Currency:</label>       <select id="drCartCurrencySelector" class="connect-cart-currencyselector">       </select>   </div></div><div class="connect-cart-offerheader"></div>',bodyTemplate:'<div class="connect-cart-body connect-loading">   <div class="connect-cart-loadingmask">      <span class="connect-spinner"></span>   </div>   <div class="connect-content">       <%= emptyCartMessage %>   </div></div>',emptyCartTemplate:"<p>Your Shopping Cart is empty.</p>",totalsTemplate:'<div class="connect-cart-totals">   <div class="connect-cart-subtotal">       <span>Subtotal:</span><span class="amount">0.00</span></div>   <div class="connect-fine-print">       <span>Excludes tax and shipping</span>   </div></div>',couponTemplate:'<div class="connect-cart-couponwrapper connect-widget-button">    <input id="couponCode" class="connect-widget-couponcode" type="text" value="" placeholder="Enter Coupon Code"/>    <a class="connect-cart-applycoupon" disabled="disabled" href="#">        <i class="icon-ok-sign"></i> Apply Code    </a></div>',footerTemplate:'<div class="connect-cart-footer">    <div class="connect-widget-link">        <a href="#" class="connect-cart-showcode">Have a Promo Code?</a>    </div>    <div class="connect-widget-button right">        <a href="#" class="connect-cart-checkout"><i class="icon-shopping-cart icon"></i> Checkout</a>    </div>    <div class="connect-widget-clearfix"></div></div>',offerHeaderTemplate:"<span><%= offerHeader %></span>",offerTemplate:'<div class="connect-cart-offer"><p class="connect-cart-title"><%= product.displayName %></p><% if (pricing && (pricing.listPrice.value > pricing.salePriceWithQuantity.value)) { %><p><img class="connect-cart-image" src="<%= product.thumbnailImage %>" alt=""/><span class="connect-cart-pricing"><span>Regular Price: </span><span class="connect-widget-strikethrough"><del><%= pricing.formattedListPrice %></del></span></span><span class="connect-cart-pricing"><span>Promo Price: </span><span><%= pricing.formattedSalePriceWithQuantity %></span></span><%} else { %><p><img class="connect-cart-image" src="<%= product.thumbnailImage %>" alt=""/><span class="connect-cart-pricing"><%= pricing.formattedSalePriceWithQuantity %></span><% } %><div class="connect-widget-button"><a class="connect-cart-buy" data-value="<%= addProductToCart.uri %>" href="<%= addProductToCart.uri %>"><i class="icon-plus-sign"></i> Add</a></div></p><div style="line-height: 1; clear: both;"></div></div>',productTemplate:'<div class="connect-cart-lineitem"><p class="connect-cart-title" title="<%= product.shortDescription %>"><%= product.displayName %></p><img src="<%= product.thumbnailImage %>"/><div><span>Quantity: </span>   <input autocomplete="off" type="text" class="connect-cart-quantity" data-lineitem-id="<%= id %>" value="<%= quantity %>"<% if (product.inventoryStatus && product.inventoryStatus.maxOrderQuantity !== undefined){ %> data-maxorderquantity=<%=product.inventoryStatus.maxOrderQuantity%><%} %>/>   <span class="connect-widget-button"><a class="connect-cart-updatebtn" href="#"><i class="icon-refresh"></i></a></span></div><ul><li class="connect-cart-remove"><span><a href="#" data-lineitem-id="<%= id %>"><i class="icon-remove"></i> Remove</a></span></li><li class="connect-cart-sku"><span class="connect-cart-label">SKU: <%= product.sku %></span></li><li class="connect-lineitem-pricing"><span class="connect-cart-label">Price: </span><% if (pricing.listPriceWithQuantity.value > pricing.salePriceWithQuantity.value) { %> <span class="connect-widget-strikethrough"><%= pricing.formattedListPriceWithQuantity %>&nbsp;</span><%}%><span class="connect-lineitem-saleprice"><%= pricing.formattedSalePriceWithQuantity %></span></li></ul><div style="line-height: 1; clear: both;">&nbsp;</div></div>',subtotalTemplate:'<% if (discount.value && discount.value > 0) { %><div class="connect-cart-orderdiscount"><span>Discount: </span><span class="amount">-<%= formattedDiscount %></span></div> <%}%><% if (shippingAndHandling.value != null) { %><div class="connect-cart-orderdiscount"><span>Estimated Shipping: </span><span class="amount"><%= formattedShippingAndHandling %></span></div> <%}%><div class="connect-cart-subtotal"><span>Subtotal: </span><span class="amount"><%= formattedOrderTotal %></span></div><div class="connect-fine-print"><span>Excludes tax</span></div>',feedbackTemplate:'<p><i class="icon-ok-sign"></i> <%= msg %></p>',errorTemplate:'<p><i class="icon-warning-sign"></i> <%= msg %></p>',summaryElementSelector:"#drMiniCartSummary",cartElementSelector:"#drMiniCart",currency:["USD"],defaultCurrency:"USD"};return t.extend({init:function(){var e=this,t;e._super.apply(e,arguments),r.call(e,{qty:0,subtotal:"0.0"}),i.call(e),t=$(e.getOption("cartElementSelector")),t.on("change",".connect-cart-currencyselector",function(){var t=$(this).val();$(e).trigger("drconnect-changecurrency",[t])}),t.find(".connect-cart-showcode").on("click",function(e){e.preventDefault(),$(this).hide(),t.find(".connect-cart-couponwrapper").show().find("> input").select().focus()}),$("#couponCode").on("keypress paste",function(){var e=$(this);(e.val()!==""||e.val()!=null)&&e.parent(".connect-cart-couponwrapper").find('>a[class^="connect-"]').removeAttr("disabled")})},getDefaults:function(){return n},compileTemplates:function(){var t=this;t.compileSummaryTemplate(),t.compileCartOfferTemplate(),t.offerHeaderTemplate=e.template(t.getOption("offerHeaderTemplate")),t.compileProductTemplate(),t.compileSubtotalTemplate(),t.feedbackTemplate=e.template(t.getOption("feedbackTemplate")),t.errorTemplate=e.template(t.getOption("errorTemplate")),t.emptyCartTemplate=e.template(t.getOption("emptyCartTemplate"))},compileSummaryTemplate:function(){var t=this,n=$("#drMiniCartSummaryTemplate");n.length?t.summaryTemplate=e.template(n.html()):t.summaryTemplate=e.template(t.getOption("summaryTemplate"))},compileCartOfferTemplate:function(){var t=this,n=$("#drMiniCartOfferTemplate");n.length?t.cartOfferTemplate=e.template(n.html()):t.cartOfferTemplate=e.template(t.getOption("offerTemplate"))},compileProductTemplate:function(){var t=this,n=$("#drMiniCartProductTemplate");n.length?t.productTemplate=e.template(n.html()):t.productTemplate=e.template(t.getOption("productTemplate"))},compileSubtotalTemplate:function(){var t=this,n=$("#drMiniCartSubtotalTemplate");n.length?t.subtotalTemplate=e.template(n.html()):t.subtotalTemplate=e.template(t.getOption("subtotalTemplate"))},setOptions:function(e){e.summaryElement&&(e.summaryElementSelector="#"+e.summaryElement),e.cartElement&&(e.cartElementSelector="#"+e.cartElement),this._super.apply(this,[e])},updateCartSummary:function(e){var t=this,n=$(t.getOption("summaryElementSelector")),r={},i;r.qty=e.totalItemsInCart||"0",e.pricing!=null?r.subtotal=e.pricing.formattedOrderTotal:r.subtotal="0.0",n.length&&(i=t.summaryTemplate(r),n.html(i))},updateCart:function(e,t){var n=this,r=$(n.getOption("cartElementSelector"));e.lineItems&&e.lineItems.lineItem&&e.lineItems.lineItem.length?n.showLineItems(r,e):t.then(function(e){n.showEmptyCartOffers(r,e)}),$(n).trigger("drconnect-cartrender")},showLineItems:function(e,t){var n=this,r=[];e.find(".connect-cart-offerheader").hide().end().find(".connect-cart-totals").show().end().find(".connect-cart-footer").show().find(".connect-cart-showcode").show();try{r=t.lineItems.lineItem||[]}catch(i){}n.renderLineItems(e,r),n.setupEventListeners(e),n.updateCartSubtotal(t),$(n).trigger("drconnect-updatecart",[t])},renderLineItems:function(t,n){var r=this,i="";e.each(n,function(e){var t,n,s;if(e&&e.product!==undefined&&e.product.inventoryStatus!==undefined){t=e.product,n=e.product.inventoryStatus,s=parseInt(n.availableQuantity,10),isNaN(s)||(n.availableQuantity=s);if(t.maxOrderQuantity!==undefined)n.maxOrderQuantity=t.maxOrderQuantity;else if(n.productIsAllowsBackorders==="false"||n.productIsAllowsBackorders===!1)n.maxOrderQuantity=s-e.quantity;n.minOrderQuantity=t.minOrderQuantity||0}i+=r.productTemplate(e)}),t.find(".connect-cart-body .connect-content").empty().html(i).end()},setupEventListeners:function(e){var t=this;e.hasClass("initialized")||e.addClass("initialized").on("keypress",'input[type="text"]',function(e){e.keyCode===13&&$(t).trigger("drconnect-updatequantity",[this.value,this]),e.stopImmediatePropagation()}).on("click",".connect-cart-remove a",function(e){e.preventDefault(),$(t).trigger("drconnect-remove",[this])}).on("click",".connect-cart-applycoupon",function(){if(!$(this).attr("disabled")&&!$(this).hasClass("disabled")){var e=$("#couponCode").get(0);$(t).trigger("drconnect-applycoupon",[e,this])}return!1}).on("click",".connect-cart-buy",function(e){e.preventDefault();var n=this.value||this.href;$(t).trigger("drconnect-addtocart",[{value:n},this])}).on("click",".connect-cart-updatebtn",function(){var e=$(this),n;return!e.attr("disabled")&&!e.hasClass("disabled")&&(n=e.siblings('input[type="text"]'),n.length&&n.val()>-1&&$(t).trigger("drconnect-updatequantity",[n.val(),n.get(0)])),!1})},updateCartSubtotal:function(e){var t=this,n=e.pricing,r=$(t.getOption("cartElementSelector"));n&&n.formattedOrderTotal!=null?(n.discount&&typeof n.discount.value=="string"&&(isNaN(parseInt(n.discount.value,10))||(n.discount.value=parseInt(n.discount.value,10))),n.shippingAndHandling&&typeof n.shippingAndHandling.value=="string"&&(isNaN(parseInt(n.shippingAndHandling.value,10))||(n.shippingAndHandling.value=parseInt(n.shippingAndHandling.value,10))),r.find(".connect-cart-totals").empty().html(t.subtotalTemplate(n))):(n={formattedOrderTotal:"0.00",discount:{value:0},shippingAndHandling:{value:0}},r.find(".connect-cart-totals").empty().html(t.subtotalTemplate(n)))},showEmptyCartOffers:function(e,t){var n=this;n.renderEmptyOffers(e,t),e.find(".connect-cart-totals").hide().end().find(".connect-cart-couponwrapper").hide().end().find(".connect-cart-footer").hide(),n.setupEventListeners(e),$(n).trigger("drconnect-updatecart",[t])},renderEmptyOffers:function(e,t){var n=this,r="",i=[],s,o;try{i=t.productOffers.productOffer}catch(u){}if(i.length){t.salesPitch[0]&&e.find(".connect-cart-offerheader").show().html(n.offerHeaderTemplate({offerHeader:t.salesPitch[0]}));for(s=0,o=i.length;s<o;s+=1)r+=n.cartOfferTemplate(i[s])}else r=n.emptyCartTemplate();e.find(".connect-cart-body .connect-content").empty().html(r).end()},hideCouponEntry:function(){var e=this.getOptions(),t;t=$(e.cartElementSelector),t.find(".connect-cart-couponwrapper").hide().find('>a[class^="connect-"]').attr("disabled","disabled"),t.find(".connect-cart-showcode").show()},setCurrency:function(e){var t=this,n=$(t.getOption("cartElementSelector")),r;r=n.find(".connect-cart-currencyselector"),r.val(e)},blockCartUI:function(){var e=this,t=$(e.getOption("cartElementSelector"));t.find(".connect-cart-body").addClass("connect-loading").find(".connect-content").scrollTop(0).end().find(".connect-cart-currencyselector").attr("disabled","disabled")},unblockCartUI:function(){var e=this;$(e.getOption("cartElementSelector")).find(".connect-cart-body").removeClass("connect-loading").find(".connect-content").scrollTop(0).end().find(".connect-cart-currencyselector").removeAttr("disabled")},showFeedback:function(e,t){var n=this,r,i=$(n.getOption("cartElementSelector")),s=i.find(".connect-cart-feedback");t=!!t,r=t?n.errorTemplate({msg:e}):n.feedbackTemplate({msg:e}),n.feedbackTO!==null?(clearTimeout(n.feedbackTO),n.feedbackTO=null,n.hideFeedback(function(){s.toggleClass("connect-cart-error",t).html(r).fadeIn()})):s.toggleClass("connect-cart-error",t).html(r).fadeIn(),n.feedbackTO=setTimeout(function(){n.hideFeedback()},5e3)},hideFeedback:function(e){var t=this,n=$(t.getOption("cartElementSelector"));n.find(".connect-cart-feedback").fadeOut(function(){typeof e=="function"&&e.call(this)})},getCartElement:function(){return $(this.getOption("cartElementSelector"))}})}),define("dr-minicart",["api/Client","config","service/CartService","view/CartView","util/Class"],function(e,t,n,r,i){function o(e,t,n){var r=/\/?ProductID[=\.](\d+)\/?/i,i=/\/?Quantity[=\.](\d+)\/?/i;n===undefined&&(n=document),$(s,n).each(function(){var n=this.href.match(r)[1],s=i.test(this.href)?RegExp.$1:"1";$(this).on("click",function(r){var i=$(this);r.preventDefault(),i.addClass("disabled"),t.addLineItemToCartById(n,s,i.attr("href")).then(function(n){typeof n=="string"?window.location.href=n:(e.updateCartSummary(n),e.updateCart(n,t.getEmptyCartOffer()),i.removeClass("disabled"),e.showFeedback("Item added to cart"))},function(t){i.removeClass("disabled"),e.showFeedback(t.message,!0)})})})}var s='a[href*="AddItemToRequisition"],area[href*="AddItemToRequisition"],a[href*="/store/"][href*="/buy/"][href*="/productID."],area[href*="/store/"][href*="/buy/"][href*="/productID."]';return i.extend({defaults:{summaryElement:"drMiniCartSummary",cartElement:"drMiniCart",rewriteLinks:!0},init:function(t){var i=this,s,u,a,f;i.setOptions(t),a=i.getOptions(),a.client&&a.client instanceof e?i.client=a.client:a.apiKey&&(i.client=new e(a.apiKey)),s=new n(i.client),u=new r(t),a.rewriteLinks!==!1&&o.call(i,u,s),$(s).on("drconnect-beforeaddproduct drconnect-beforeremoveitem drconnect-beforequantityupdate drconnect-beforeapplycode",function(){u.blockCartUI()}).on("drconnect-carterror",function(){u.unblockCartUI()}),f=u.getCartElement(),$(u).on("drconnect-addtocart",function(e,t){s.addLineItemToCart(t.value).then(function(e){u.showFeedback("Item added to cart."),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer()),f.trigger("drconnect-addtocart",[e])},function(e){u.showFeedback(e.message,!0)})}).on("drconnect-updatequantity",function(e,t,n){var r=$(n).attr("data-lineitem-id");t!==n.defaultValue&&(!isNaN(t-0)&&t-0>0?r&&(f.trigger("drconnect-updatequantity",[r,t,n]),s.updateQuantity(r,t).then(function(e){u.showFeedback("Quantity Updated"),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer())},function(){u.showFeedback("Unable to Update",!0),n.value=n.defaultValue})):(u.showFeedback("Please enter a number greater than zero",!0),n.value=n.defaultValue))}).on("drconnect-remove",function(e,t){var n=$(t).attr("data-lineitem-id");n&&s.removeLineItem(n).then(function(e){f.trigger("drconnect-remove",[n]),u.showFeedback("Item removed"),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer())})}).on("drconnect-updatecart",function(e,t){u.unblockCartUI(),f.trigger("drconnect-updatecart",[t])}).on("drconnect-changecurrency",function(e,t){u.blockCartUI(),i.client.updateShopper({currency:t}).then(function(){f.trigger("drconnect-changecurrency",[t]),u.showFeedback("Currency Settings Updated");return},function(){u.showFeedback("Unable to update Currenct Settings",!0);return}).done(function(){s.clearCache(),s.getActiveCart().then(function(e){u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer())})})}).on("drconnect-applycoupon",function(e,t){var n=$(t).val();n!=null&&s.applyCouponCode(n).then(function(e){u.showFeedback("Coupon code applied. Final price will be determined at checkout."),$(t).val(""),u.updateCartSummary(e),u.updateCart(e,s.getEmptyCartOffer()),u.hideCouponEntry()})}).on("drconnect-cartrender",function(){f.trigger("drconnect-cartrender")}),$(".connect-cart-checkout").on("click",function(){s.getWebCheckoutUrl().then(function(e){window.location=e})}),this.start(u,s)},start:function(e,n){var r=this;e.blockCartUI(),n.getActiveCart().then(function(i){i.pricing&&i.pricing.orderTotal?(e.updateCartSummary(i),e.updateCart(i,n.getEmptyCartOffer()),e.setCurrency(i.pricing.orderTotal.currency)):r.client.shopperService.list().then(function(s){s.currency?(e.updateCartSummary(i),e.updateCart(i,n.getEmptyCartOffer()),e.setCurrency(s.currency)):(e.setCurrency(t.getDefaultCurrency()),r.client.updateShopper({currency:t.getDefaultCurrency(),locale:t.getDefaultLocale()}).then(function(){e.updateCartSummary(i),e.updateCart(i,n.getEmptyCartOffer())}))})})},setOptions:function(e){var n=this;n.options=$.extend({},e),n.options.emptyOfferId&&t.setEmptyOfferId(n.options.emptyOfferId),n.options.emptyOfferPop&&t.setEmptyOfferPop(n.options.emptyOfferPop),n.options.siteId&&t.setSiteId(n.options.siteId),n.options.vanityDomain&&t.setVanityDomain(n.options.vanityDomain)},getOptions:function(){return this.options},setOption:function(e,t){this.options[e]=t},getOption:function(e){return this.options[e]}})});